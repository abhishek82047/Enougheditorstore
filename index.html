<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enough Editor - Buy Source Code & Website Templates in India</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="High-quality source codes, website templates, and digital assets for modern creators in India. Instant downloads, secure payments via Razorpay, and premium support.">
    <meta name="keywords" content="digital products, website templates, source code, video editing assets, enough editor, buy source code, templates India, razorpay, flash sale">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://enougheditor.store/">
    <meta property="og:title" content="Enough Editor - Premium Digital Assets & Source Code">
    <meta property="og:description" content="High-quality source codes, website templates, and digital assets for modern creators.">
    <meta property="og:image" content="https://images.ctfassets.net/v2a2klvd105s/gjx4upwjUBLFONCJ5edhz/af8e01f94334cc0b62bf9578879a5d4b/Picsart_24-03-13_09-03-19-742.png">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://enougheditor.store/">
    <meta property="twitter:title" content="Enough Editor - Premium Digital Assets & Source Code">
    <meta property="twitter:description" content="High-quality source codes, website templates, and digital assets for modern creators.">
    <meta property="twitter:image" content="https://images.ctfassets.net/v2a2klvd105s/gjx4upwjUBLFONCJ5edhz/af8e01f94334cc0b62bf9578879a5d4b/Picsart_24-03-13_09-03-19-742.png">

    <link rel="icon" href="https://images.ctfassets.net/v2a2klvd105s/gjx4upwjUBLFONCJ5edhz/af8e01f94334cc0b62bf9578879a5d4b/Picsart_24-03-13_09-03-19-742.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" /> 
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* IMPROVEMENT: Added View Transitions for smooth theme changes */
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation: none;
          mix-blend-mode: normal;
        }
        ::view-transition-image-pair(root) {
          isolation: isolate;
        }
        @keyframes fade-in { from { opacity: 0; } }
        @keyframes fade-out { to { opacity: 0; } }
        @keyframes slide-from-right { from { transform: translateX(30px); opacity: 0;} }
        @keyframes slide-to-left { to { transform: translateX(-30px); opacity: 0;} }

        [data-bs-theme="dark"]::view-transition-old(root) {
          animation: fade-out .4s ease-out forwards;
        }
        [data-bs-theme="dark"]::view-transition-new(root) {
          animation: fade-in .4s ease-in forwards;
        }
        [data-bs-theme="light"]::view-transition-old(root) {
          animation: fade-out .4s ease-out forwards;
        }
        [data-bs-theme="light"]::view-transition-new(root) {
          animation: fade-in .4s ease-in forwards;
        }

        :root, [data-bs-theme="light"] {
             --bg-color: #f0f2f5; --text-color: #1c1e21; --card-bg: #ffffff; --border-color: #dddfe2; --primary-color: #0d6efd; --primary-text: #ffffff; --secondary-bg: #e7f3ff; --secondary-text: #0d6efd; --hero-bg: #ffffff; --hero-graphic-bg: #e7f3ff; --subtle-text: #6c757d; --footer-bg: #1e1e1e; --footer-text: #a0a3a8; --footer-heading: #ffffff;
             --success-color: #198754; --success-bg: #d1e7dd; --danger-color: #dc3545; --danger-bg: #f8d7da; --warning-color: #ffc107; --warning-bg: #fff3cd; --info-color: #0dcaf0; --info-bg: #cff4fc;
        }
        [data-bs-theme="dark"] {
            --bg-color: #121212; --text-color: #e4e6eb; --card-bg: #1e1e1e; --border-color: #3a3b3c; --primary-color: #4b88ff; --primary-text: #ffffff; --secondary-bg: #2a2a2a; --secondary-text: #e4e6eb; --hero-bg: #121212; --hero-graphic-bg: #1e1e1e; --subtle-text: #a0a3a8; --footer-bg: #1e1e1e; --footer-text: #a0a3a8; --footer-heading: #ffffff;
            --success-color: #61b787; --success-bg: #1c2b23; --danger-color: #f17474; --danger-bg: #2c1b1f; --warning-color: #ffca2c; --warning-bg: #2e2816; --info-color: #61daff; --info-bg: #1a2c3d;
        }
        html, body { overflow-x: hidden; scroll-behavior: smooth; }
        body { background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; transition: background-color 0.4s ease, color 0.4s ease; }
        #app-container { flex: 1; }
        .cursor-dot, .cursor-outline { pointer-events: none; position: fixed; top: 0; left: 0; border-radius: 50%; z-index: 10000; mix-blend-mode: difference; }
        .cursor-dot { width: 8px; height: 8px; background-color: white; transform: translate(-50%, -50%); }
        .cursor-outline { width: 40px; height: 40px; border: 2px solid white; transform: translate(-50%, -50%); transition: width 0.3s ease, height 0.3s ease; }
        body.cursor-hover .cursor-outline { width: 60px; height: 60px; }
        .cursor-splash { position: fixed; border-radius: 50%; pointer-events: none; border: 1px solid white; animation: splash-animation 0.5s ease-out forwards; z-index: 9999; mix-blend-mode: difference; }
        @keyframes splash-animation { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        @media (pointer: coarse) { body { cursor: auto; } .cursor-dot, .cursor-outline, .cursor-splash { display: none; } }
        
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); display: block; z-index: 9999; transition: opacity 0.5s ease-out; overflow: hidden; }
        .skeleton { opacity: 0.7; animation: shimmer 1.5s linear infinite; background: linear-gradient(90deg, var(--secondary-bg) 25%, var(--hero-graphic-bg) 50%, var(--secondary-bg) 75%); background-size: 200% 100%; border-radius: 4px;}
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        #preloader.preloader-hidden { opacity: 0; pointer-events: none; }
        .skeleton-hero { padding: 5rem 0; } .skeleton-h1 { height: 2.8rem; margin-bottom: 0.75rem; } .skeleton-p { height: 1.2rem; margin-bottom: 0.5rem; } .skeleton-btn { height: 48px; width: 180px; border-radius: 8px; } .skeleton-section-title { height: 2.5rem; width: 40%; max-width: 400px; margin: 0 auto 1rem auto; } .skeleton-section-subtitle { height: 1.1rem; width: 60%; max-width: 500px; margin: 0 auto 3rem auto; } .skeleton-card { background-color: var(--card-bg); border-radius: 12px; padding: 1rem; border: 1px solid var(--border-color); } .skeleton-img { height: 200px; border-radius: 8px; margin-bottom: 1rem; } .skeleton-text { height: 1rem; margin-bottom: 0.5rem; } .navbar.sticky-top { background-color: rgba(var(--bg-color-rgb), 0.85); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 0.5rem 0; transition: background-color 0.4s ease; }
        .navbar .nav-link { color: var(--subtle-text); font-weight: 500; transition: color 0.2s; padding: 0.5rem 1rem; border-radius: 6px; position: relative; background-color: transparent !important; } .navbar .nav-link::after { content: ''; position: absolute; bottom: 5px; left: 1rem; right: 1rem; height: 2px; background-color: var(--primary-color); transform: scaleX(0); transform-origin: center; transition: transform 0.3s ease-in-out; } .navbar .nav-link:hover, .navbar .nav-link.active { color: var(--text-color); } .navbar .nav-link:hover::after, .navbar .nav-link.active::after { transform: scaleX(1); }
        .nav-action-btn { border: 1px solid var(--border-color); color: var(--text-color); background-color: transparent; border-radius: 8px; transition: background-color 0.2s; height: 42px; }
        .nav-action-btn:hover { background-color: var(--secondary-bg); }
        .dropdown-menu { background-color: var(--card-bg); border-color: var(--border-color); transition: background-color 0.4s ease; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.6s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hero-section { padding: 5rem 0; background-color: var(--hero-bg); position: relative; overflow: hidden; transition: background-color 0.4s ease; } .hero-section .display-3 { font-weight: 800; } .hero-section .display-3 .text-primary { color: var(--primary-color) !important; }
        .scroll-prompt { position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%); color: var(--subtle-text); font-weight: 500; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translate(-50%, 0); } 40% { transform: translate(-50%, -10px); } 60% { transform: translate(-50%, -5px); } }
        .hero-badge { display: inline-block; background-color: var(--secondary-bg); color: var(--secondary-text); padding: 0.5rem 1rem; border-radius: 20px; font-weight: 500; margin-bottom: 1rem; }
        .trust-badge { display: flex; align-items: center; gap: 0.5rem; color: var(--subtle-text); font-size: 0.9rem; }
        .hero-graphic { position: relative; min-height: 300px; } .hero-graphic .main-shape { width: 60%; height: 60%; background-color: var(--primary-color); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(45deg); opacity: 0.8; border-radius: 20%; animation: rotate-slow 30s linear infinite; } .hero-graphic .secondary-shape { width: 75%; height: 75%; background-color: var(--hero-graphic-bg); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(15deg); border-radius: 30%; animation: rotate-slow 40s linear infinite reverse; } @keyframes rotate-slow { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } } @media (max-width: 991.98px) { .hero-section .col-lg-6 { position: relative; z-index: 1; } .hero-graphic { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.15; } .hero-graphic .main-shape { width: 90%; height: 90%; } .hero-graphic .secondary-shape { width: 110%; height: 110%; } } #password-strength-meter .progress-bar { transition: width 0.3s ease, background-color 0.3s ease; } #requirement-list li { transition: color 0.3s ease; color: var(--subtle-text); } #requirement-list li.valid { color: var(--success-color); } #requirement-list li.invalid { color: var(--danger-color); } #requirement-list li i { vertical-align: middle; } .section { padding: 4rem 0; } .section-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; } .section-subtitle { font-size: 1.1rem; color: var(--subtle-text); max-width: 600px; margin: 0 auto 3rem auto; } .feature-item i { font-size: 2rem; color: var(--primary-color); }

        /* IMPROVED: Product Card Styles */
        .card { 
            background-color: var(--card-bg); 
            border: 1px solid var(--border-color); 
            transition: transform .2s, box-shadow .2s, background-color 0.4s ease; 
            border-radius: 12px; 
            overflow: hidden; 
            position: relative; /* Needed for child absolute positioning */
        } 
        .card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); /* Increased shadow */
        }
        /* Make the main content of the card clickable */
        .product-card .card-link-area {
            display: block;
            text-decoration: none;
            color: inherit; /* Inherit text color from parent */
        }
        .product-card .card-link-area:hover {
            color: inherit;
        }

        .card-img-top { aspect-ratio: 16 / 9; object-fit: cover; }
        .product-card .card-img-container { position: relative; overflow: hidden; /* Ensure zoom effect is clipped */ }
        .product-card .card-img-top { 
            aspect-ratio: 6 / 7; 
            object-fit: cover;
            transition: transform 0.3s ease-in-out; /* Add transition for zoom effect */
        }
        /* IMPROVED: Image Zoom Effect */
        .product-card:hover .card-img-top {
            transform: scale(1.05); /* Zoom in effect */
        }

        .product-tag { position: absolute; top: 12px; left: 12px; background-color: var(--primary-color); color: var(--primary-text); padding: 0.25rem 0.7rem; border-radius: 6px; font-size: 0.8rem; font-weight: 600; z-index: 1; /* Ensure tag is above image */ }
        .wishlist-btn { position: absolute; top: 12px; right: 12px; z-index: 2; background-color: rgba(var(--card-bg-rgb), 0.7); backdrop-filter: blur(4px); border: 1px solid var(--border-color); color: var(--danger-color); }
        .discount-badge { background-color: var(--danger-color); color: white; padding: 0.25rem 0.6rem; border-radius: 6px; font-size: 0.8rem; font-weight: 700; z-index: 1; }
        .limited-stock-badge { background-color: var(--warning-bg); color: var(--warning-color); border: 1px solid var(--warning-color); padding: 0.25rem 0.6rem; border-radius: 6px; font-size: 0.8rem; font-weight: 700; }
        .product-countdown-timer { background-color: rgba(var(--card-bg-rgb), 0.85); backdrop-filter: blur(5px); border-top: 1px solid var(--border-color); text-align: center; padding: 0.5rem; font-weight: 500; font-size: 0.9rem; color: var(--danger-color); }
        .product-countdown-timer i { vertical-align: middle; }
        .toast-container { z-index: 1100; bottom: 1rem; } .toast.toast-custom { border-radius: 8px !important; border-left: 5px solid; } .toast.toast-custom.toast-success { background-color: var(--success-bg) !important; border-color: var(--success-color); } .toast.toast-custom.toast-danger { background-color: var(--danger-bg) !important; border-color: var(--danger-color); } .toast.toast-custom.toast-warning { background-color: var(--warning-bg) !important; border-color: var(--warning-color); } .toast.toast-custom.toast-info { background-color: var(--info-bg) !important; border-color: var(--info-color); } .toast.toast-custom .toast-body, .toast.toast-custom .btn-close { color: var(--text-color) !important; opacity: 0.8; } .product-gallery .main-image-container { margin-bottom: 1rem; position: relative; } .product-gallery .main-image { width: 100%; aspect-ratio: 6 / 7; object-fit: cover; border-radius: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: opacity 0.3s; } .product-gallery .thumbnail-strip { display: flex; gap: 0.75rem; flex-wrap: wrap; } .product-gallery .thumbnail { width: 60px; height: 70px; object-fit: cover; border-radius: 0.5rem; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s, transform 0.2s; opacity: 0.7; } .product-gallery .thumbnail:hover { transform: scale(1.05); opacity: 1; } .product-gallery .thumbnail.active { border-color: var(--primary-color); opacity: 1; } .accordion-button { font-weight: 600; } .accordion-button:not(.collapsed) { background-color: var(--secondary-bg); color: var(--text-color); box-shadow: none; } .accordion-item { background-color: var(--card-bg); border-color: var(--border-color); } .star-rating { display: flex; flex-direction: row-reverse; justify-content: flex-end; } .star-rating input { display: none; } .star-rating label { color: #ccc; cursor: pointer; font-size: 2rem; padding: 0 0.1em; transition: color 0.2s; } .star-rating input:checked ~ label, .star-rating:not(:checked) > label:hover, .star-rating:not(:checked) > label:hover ~ label { color: #ffc107; } #giveaway-view .card { max-width: 700px; margin: 0 auto; } #countdown-timer, .sale-countdown-timer { display: flex; justify-content: center; gap: 1rem; text-align: center; } #countdown-timer > div, .sale-countdown-timer > div { background-color: var(--secondary-bg); padding: 0.5rem 1rem; border-radius: 8px; } #countdown-timer > div span, .sale-countdown-timer > div span { display: block; font-size: 2rem; font-weight: 700; color: var(--primary-color); } #countdown-timer > div small, .sale-countdown-timer > div small { font-size: 0.8rem; text-transform: uppercase; color: var(--subtle-text); } .winner-announcement { background-color: var(--success-bg); color: var(--success-color); border: 1px solid var(--success-color); padding: 1.5rem; border-radius: 12px; text-align: center; } .winner-announcement .display-4 { font-weight: 700; } .payment-section { background-color: var(--hero-graphic-bg); } [data-bs-theme="dark"] .payment-section { background-color: #1c1e21; } .payment-section .main-payment-logo-container { background-color: #ffffff; padding: 2rem; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.07); max-width: 550px; margin: 0 auto; } .payment-section .main-payment-logo-container img { max-width: 100%; } .logo-scroller { max-width: 900px; margin: 2.5rem auto 0 auto; overflow: hidden; -webkit-mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent); mask-image: linear-gradient(to right, transparent, white 20%, white 80%, transparent); } .logo-scroller-inner { display: flex; align-items: center; width: fit-content; animation: scroll 20s linear infinite; } .logo-scroller-inner:hover { animation-play-state: paused; } .payment-method-logo { background-color: #ffffff; padding: 0.75rem; border-radius: 0.75rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: 50px; display: flex; align-items: center; justify-content: center; margin: 0 1.5rem; } .payment-method-logo img { height: 100%; max-width: 100px; object-fit: contain; } @keyframes scroll { to { transform: translateX(-50%); } } .site-footer { background-color: var(--footer-bg); color: var(--footer-text); transition: background-color 0.4s ease, color 0.4s ease; } .site-footer h5 { color: var(--footer-heading); font-weight: 700; } .site-footer a { color: var(--footer-text); text-decoration: none; transition: color 0.2s; } .site-footer a:hover { color: #ffffff; text-decoration: underline; } .footer-social-icons a { font-size: 1.5rem; margin-right: 1rem; } .mobile-nav { display: none; } .form-check-input:checked { background-color: var(--primary-color); border-color: var(--primary-color); }

        /* Testimonials Swiper-specific CSS */
        .testimonials-section { background-color: var(--card-bg); padding: 4rem 0; overflow: hidden; transition: background-color 0.4s ease; }
        .testimonials-swiper { padding-top: 2rem; padding-bottom: 3rem; }
        .testimonial-card { 
            background-color: var(--bg-color); 
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            padding: 2rem; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            transition: background-color 0.4s ease; 
        }
        .testimonial-text { font-size: 1.1rem; font-style: italic; color: var(--subtle-text); flex-grow: 1; margin-bottom: 1.5rem; }
        .testimonial-author { display: flex; align-items: center; gap: 1rem; }
        .testimonial-author-icon { width: 50px; height: 50px; border-radius: 50%; background-color: var(--secondary-bg); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .testimonial-author-icon i { color: var(--primary-color); }
        .testimonial-author-info h6 { margin: 0; font-weight: 700; }
        .testimonial-stars { color: #ffc107; }
        .swiper-pagination-bullet-active { background-color: var(--primary-color) !important; }
        /* These styles make the non-active slides smaller and transparent, creating the "carousel" effect */
        .testimonials-swiper .swiper-slide { transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out; transform: scale(0.85); opacity: 0.7; height: auto; }
        .testimonials-swiper .swiper-slide-active { transform: scale(1.0); opacity: 1; z-index: 1; } /* Changed scale to 1.0 for active slide */
        .testimonials-swiper .swiper-slide .testimonial-card { height: 100%; }

        /* Styles for the mobile nav bar */
        @media (max-width: 991.98px) {
            .navbar.sticky-top {
                top: 0; /* Align navbar to top as marquee is removed */
            }
            .navbar .navbar-toggler, .navbar .navbar-nav { display: none !important; }
            .navbar .container { justify-content: space-between; }
            body { padding-bottom: 70px; } /* Space for the fixed mobile nav */
            .mobile-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 70px;
                background-color: rgba(var(--card-bg-rgb), 0.9); /* IMPROVED: 10% transparency */
                border-top: 1px solid var(--border-color);
                z-index: 1002;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            .mobile-nav-item {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-decoration: none;
                color: var(--subtle-text);
                font-size: 0.75rem;
                position: relative;
            }
            .mobile-nav-item i {
                font-size: 1.5rem;
                margin-bottom: 2px;
            }
            .mobile-nav-item.active {
                color: var(--primary-color);
            }
            #mobile-cart-count-badge {
                position: absolute;
                top: 8px;
                right: 20px;
                font-size: 0.65rem;
                padding: .2em .5em;
            }
            .toast-container { bottom: 85px; }

            /* Removed radial menu styles as it's no longer used */
            .radial-menu-container, .radial-menu-backdrop {
                display: none !important;
            }
            .mobile-nav-item.more-btn { /* Ensure this button is hidden/removed if its purpose is gone */
                display: none !important;
            }
        }
        /* Style for flash sale icon */
        .sale-countdown-timer .bi-fire {
            color: #ff4500; /* Orange-red for fire */
            animation: pulse 1s infinite alternate;
            margin-right: 5px;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }
    </style>
</head>
<body>
    
    <div id="preloader">
        <div class="skeleton-hero container">
            <div class="row align-items-center g-5">
                <div class="col-lg-6">
                    <div class="skeleton" style="height: 38px; width: 250px; border-radius: 20px; margin-bottom: 1rem;"></div>
                    <div class="skeleton skeleton-h1" style="width: 100%;"></div>
                    <div class="skeleton skeleton-h1" style="width: 70%;"></div>
                    <div class="skeleton skeleton-p" style="width: 90%; margin-top: 1rem;"></div>
                    <div class="skeleton skeleton-p" style="width: 80%;"></div>
                    <div class="skeleton skeleton-btn mt-4"></div>
                </div>
                <div class="col-lg-6 d-none d-lg-block">
                     <div class="skeleton" style="min-height: 300px; border-radius: 30%;"></div>
                </div>
            </div>
        </div>
        <div class="container text-center" style="padding: 4rem 0;">
            <div class="skeleton skeleton-section-title"></div>
            <div class="skeleton skeleton-section-subtitle"></div>
            <div class="row row-cols-2 row-cols-lg-4 g-4">
                <div class="col"><div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width: 75%;"></div></div></div>
                <div class="col"><div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width: 75%;"></div></div></div>
                <div class="col"><div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width: 75%;"></div></div></div>
                <div class="col"><div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton skeleton-text"></div><div class="skeleton skeleton-text" style="width: 75%;"></div></div></div>
            </div>
        </div>
    </div>

    <div id="app-container" style="display: none; flex-direction: column;">
        <!-- TOP MARQUEE TEXT REMOVED -->
        <nav class="navbar navbar-expand-lg sticky-top">
            <div class="container">
                <a class="navbar-brand fw-bold fs-4 d-flex align-items-center" href="#home">
                    <img src="https://images.ctfassets.net/v2a2klvd105s/gjx4upwjUBLFONCJ5edhz/af8e01f94334cc0b62bf9578879a5d4b/Picsart_24-03-13_09-03-19-742.png" alt="Enough Editor Logo" style="height: 32px; margin-right: 10px;">
                    Enough Editor
                </a>
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item"><a class="nav-link active" href="#home">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="#products">Products</a></li>
                        <li class="nav-item"><a class="nav-link" href="#wishlist">Wishlist</a></li>
                        <li class="nav-item"><a class="nav-link" href="#blog">Blog</a></li>
                        <li class="nav-item"><a class="nav-link" href="#giveaway">Giveaway</a></li>
                        <li class="nav-item"><a class="nav-link" href="#support">Support</a></li>
                    </ul>
                </div>
                 <div class="d-flex align-items-center gap-2">
                    <button id="theme-toggler" class="btn nav-action-btn d-flex align-items-center justify-content-center" style="width: 42px;"><i class="bi bi-moon-fill fs-5"></i></button>
                    <a href="#wishlist" class="btn nav-action-btn d-flex d-lg-none align-items-center position-relative" style="width: 42px;">
                       <i class="bi bi-heart-fill fs-5"></i>
                       <span id="wishlist-count-badge" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle" style="display: none;">0</span>
                    </a>
                    <a href="#cart" class="btn nav-action-btn d-none d-lg-flex align-items-center gap-2 position-relative">
                       <i class="bi bi-cart3 fs-5"></i>
                       <span class="d-none d-lg-inline">Cart</span>
                       <span id="cart-count-badge" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle" style="display: none;">0</span>
                    </a>
                    <div id="auth-nav-section" class="ms-2"></div>
               </div>
            </div>
        </nav>
        
        <main id="app-main">
            <div id="home-view" class="view"></div>
            <div id="products-view" class="view container py-4"></div>
            <div id="product-view" class="view container py-4"></div>
            <div id="cart-view" class="view container py-4"></div>
            <div id="wishlist-view" class="view container py-4"></div>
            <div id="profile-view" class="view container py-5"></div>
            <div id="blog-view" class="view container py-5"></div>
            <div id="blog-post-view" class="view container py-5"></div>
            <div id="giveaway-view" class="view container py-5"></div>
            <div id="support-view" class="view container py-5 text-center"><h1>Support Center</h1><p class="lead">Have questions? We're here to help. <br>Email us at: <a href="mailto:enougheditor31@gmail.com">enougheditor31@gmail.com</a></p></div>
            <div id="404-view" class="view container py-5 text-center"></div>
        </main>
        
        <!-- MODALS -->
        <div class="modal fade" id="authModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background-color: var(--card-bg); transition: background-color 0.4s ease;" id="auth-modal-content"></div></div></div>
        <div class="modal fade" id="downloadModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background-color: var(--card-bg); transition: background-color 0.4s ease;"><div class="modal-header border-0"><h5 class="modal-title fs-4">Action Complete!</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-4" id="download-content"></div></div></div></div>
        <div class="modal fade" id="refundModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background-color: var(--card-bg); transition: background-color 0.4s ease;"><div class="modal-header"><h5 class="modal-title">Refund Policy</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>All sales are final. Due to the digital nature of our products, we do not offer refunds. If you have an issue with your download, contact <a href="mailto:enougheditor31@gmail.com">enougheditor31@gmail.com</a>, and we will ensure you receive your purchased item.</p></div></div></div></div>
        <div class="modal fade" id="privacyModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background-color: var(--card-bg); transition: background-color 0.4s ease;"><div class="modal-header"><h5 class="modal-title">Privacy Policy</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>We collect your name and email for order fulfillment and account creation. All payments are processed securely by Razorpay; we do not store your payment information.</p></div></div></div></div>
        <div class="modal fade" id="referralModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content" style="background-color: var(--card-bg); transition: background-color 0.4s ease;"><div class="modal-header border-0"><h5 class="modal-title">Welcome to Enough Editor!</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-4"><i class="bi bi-gift-fill text-warning display-3"></i><h4 class="mt-3">Have a Referral Code?</h4><p class="text-muted">Enter it below to get a discount coupon for your first purchase!</p><form id="modal-redeem-form"><div class="input-group mt-3 mb-3"><input type="text" id="modal-referral-code-input" class="form-control" placeholder="Enter Referral Code" required><button type="submit" class="btn btn-primary">Redeem</button></div></form></div></div></div></div>

        <!-- ANNOUNCEMENT MODAL REMOVED -->

        <footer class="site-footer pt-5 pb-4 mt-auto">
            <div class="container text-start">
                <div class="row gy-4">
                    <div class="col-md-6 col-lg-4"><h5 class="text-uppercase mb-4">Enough Editor</h5><p>With over 4 years of experience, we craft high-quality digital assets. We are the minds behind gmmluxe.com and are actively working on ecomtelco.com.</p><div class="footer-social-icons mt-4"><a href="https://enougheditor.framer.website/" target="_blank" title="Website"><i class="bi bi-globe"></i></a><a href="mailto:enougheditor31@gmail.com" title="Email Us"><i class="bi bi-envelope-fill"></i></a><a href="https://www.instagram.com/enougheditor/" target="_blank" title="Instagram"><i class="bi bi-instagram"></i></a></div></div>
                    <div class="col-md-6 col-lg-2"><h5 class="text-uppercase mb-4">Quick Links</h5><p><a href="#home">Home</a></p><p><a href="#products">Products</a></p><p><a href="#cart">Your Cart</a></p><p><a href="#support">Support</a></p></div>
                    <div class="col-md-6 col-lg-2"><h5 class="text-uppercase mb-4">Legal</h5><p><a href="#" data-bs-toggle="modal" data-bs-target="#refundModal">Refund Policy</a></p><p><a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a></p><p><a href="/sitemap.xml" target="_blank">Sitemap</a></p></div>
                    <div class="col-md-6 col-lg-4"><h5 class="text-uppercase mb-4">For Creators</h5><p><i class="bi bi-people-fill me-2"></i> Affiliate Program (Refer & Earn)</p><p><i class="bi bi-person-fill me-2"></i> <a href="#profile">My Profile</a></p><p><i class="bi bi-envelope-fill me-2"></i> <a href="mailto:enougheditor31@gmail.com">enougheditor31@gmail.com</a></p></div>
                </div>
                <hr class="my-4">
                <p class="text-center mb-0">Â© 2024 Enough Editor. All Rights Reserved.</p>
            </div>
        </footer>
    </div>
    
    <!-- MOBILE NAVIGATION RADIAL MENU & BACKDROP REMOVED -->
    
    <nav class="mobile-nav">
        <a href="#home" class="mobile-nav-item active" data-nav="home"><i class="bi bi-house-door-fill"></i><span>Home</span></a>
        <a href="#products" class="mobile-nav-item" data-nav="products"><i class="bi bi-box-seam-fill"></i><span>Products</span></a>
        <!-- "More" button for radial menu removed -->
        <a href="#cart" class="mobile-nav-item" data-nav="cart">
            <i class="bi bi-cart-fill"></i><span>Cart</span>
            <span id="mobile-cart-count-badge" class="badge rounded-pill bg-danger" style="display: none;">0</span>
        </a>
        <a href="#profile" class="mobile-nav-item" data-nav="profile"><i class="bi bi-person-fill"></i><span>Profile</span></a>
    </nav>

    <!-- Offcanvas Menus (for filters) -->
    <div class="offcanvas offcanvas-bottom" tabindex="-1" id="filterOffcanvas" style="height: auto;"><div class="offcanvas-header"><h5 class="offcanvas-title">Filter Products</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button></div><div class="offcanvas-body" id="filter-offcanvas-body"></div></div>
    <div class="offcanvas offcanvas-bottom" tabindex="-1" id="sortOffcanvas" style="height: auto;"><div class="offcanvas-header"><h5 class="offcanvas-title">Sort By</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button></div><div class="offcanvas-body" id="sort-offcanvas-body"></div></div>
    
    <div class="toast-container position-fixed start-50 translate-middle-x p-3"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, push, get, serverTimestamp, query, orderByChild, equalTo, update } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, updateProfile, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

        // --- GLOBAL STATE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBm7ZNf1RsU1Muh02V8HIwEul8yIYvqQRg",
            authDomain: "game-cf141.firebaseapp.com",
            databaseURL: "https://game-cf141-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "game-cf141",
            storageBucket: "game-cf141.appspot.com",
            messagingSenderId: "30988944026",
            appId: "1:30988944026:web:e3c7dca0542c404d395523",
            measurementId: "G-3WN2KFTRNP"
        };
        let products = {}, settings = {}, giveaways = {}, blogs = {};
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let recentlyViewed = JSON.parse(sessionStorage.getItem('recentlyViewed')) || [];
        let downloadModal, authModal, referralModal, filterOffcanvas, sortOffcanvas; 
        let filters = { search: '', minPrice: null, maxPrice: null, sortBy: 'newest', category: 'All', onSaleOnly: false }; 
        let liveViewerInterval, giveawayCountdownInterval, testimonialSwiper; 
        const liveViewCounts = {};
        let availableCoupons = {}, appliedCoupon = null, currentUser = null, checkoutAfterLogin = false;
        const toastContainer = document.querySelector('.toast-container');
        const BASE_URL = 'https://enougheditor.store';
        
        // --- CORE & UTILITY FUNCTIONS ---
        window.showToast = (message, type = 'success', duration = 4000) => { const icons = { success: 'bi-check-circle-fill', danger: 'bi-x-circle-fill', info: 'bi-info-circle-fill', warning: 'bi-exclamation-triangle-fill' }; const iconClass = icons[type] || icons.info; const toastEl = document.createElement('div'); toastEl.className = `toast show shadow-lg mb-2 toast-custom toast-${type}`; toastEl.setAttribute('role', 'alert'); toastEl.setAttribute('aria-live', 'assertive'); toastEl.setAttribute('aria-atomic', 'true'); toastEl.innerHTML = `<div class="toast-body d-flex align-items-center justify-content-between ps-4"><div class="d-flex align-items-center"><i class="bi ${iconClass} fs-4 me-3"></i><strong style="font-weight: 500;">${message}</strong></div><button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button></div>`; toastContainer.appendChild(toastEl); const toast = new bootstrap.Toast(toastEl, { delay: duration }); toast.show(); toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove()); };
        const applyTheme = (theme) => { document.documentElement.setAttribute('data-bs-theme', theme); const cardBg = getComputedStyle(document.documentElement).getPropertyValue('--card-bg').trim(); const cardBgRgb = cardBg.startsWith('#') ? `${parseInt(cardBg.slice(1, 3), 16)}, ${parseInt(cardBg.slice(3, 5), 16)}, ${parseInt(cardBg.slice(5, 7), 16)}` : cardBg.match(/\d+/g).join(', '); document.documentElement.style.setProperty('--card-bg-rgb', cardBgRgb); const bgColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-color').trim(); const bgColorRgb = bgColor.startsWith('#') ? `${parseInt(bgColor.slice(1, 3), 16)}, ${parseInt(bgColor.slice(3, 5), 16)}, ${parseInt(bgColor.slice(5, 7), 16)}` : bgColor.match(/\d+/g).join(', '); document.documentElement.style.setProperty('--bg-color-rgb', bgColorRgb); document.querySelector('#theme-toggler > i').className = theme === 'dark' ? 'bi bi-sun-fill fs-5' : 'bi bi-moon-fill fs-5'; localStorage.setItem('theme', theme); };
        const initializeTheme = () => { const savedTheme = localStorage.getItem('theme'); applyTheme(savedTheme || 'dark'); };
        const celebrate = () => { if (typeof confetti !== 'undefined') confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 }, zIndex: 1100 }); };
        const celebrateCoupon = () => { 
            const applyButton = document.getElementById('apply-coupon-btn');
            if (applyButton && typeof confetti !== 'undefined') {
                const rect = applyButton.getBoundingClientRect();
                // Calculate origin relative to the viewport
                const origin = {
                    x: (rect.left + rect.width / 2) / window.innerWidth,
                    y: (rect.top + rect.height / 2) / window.innerHeight
                };

                const duration = 1 * 1000;
                const animationEnd = Date.now() + duration;
                const colors = ['#ffca2c', '#ffffff', '#4b88ff'];

                function frame() {
                    confetti({
                        particleCount: 2,
                        angle: 270,
                        spread: 80,
                        origin: origin,
                        colors: colors,
                        zIndex: 1101,
                        gravity: 0.5
                    });
                    if (Date.now() < animationEnd) {
                        requestAnimationFrame(frame);
                    }
                }
                requestAnimationFrame(frame);
            }
        };
        const trackRecentlyViewed = (productId) => { recentlyViewed = recentlyViewed.filter(id => id !== productId); recentlyViewed.unshift(productId); if (recentlyViewed.length > 8) { recentlyViewed.pop(); } sessionStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed)); };
        const updateSchema = (schemaData, schemaId = 'page-schema') => { const existingSchema = document.getElementById(schemaId); if (existingSchema) { existingSchema.remove(); } if (schemaData) { const script = document.createElement('script'); script.type = 'application/ld+json'; script.id = schemaId; script.text = JSON.stringify(schemaData); document.head.appendChild(script); }};
        const renderStars = (rating, colorClass = 'text-warning') => { let stars = ''; for(let i = 1; i <= 5; i++) { if (rating >= i) { stars += `<i class="bi bi-star-fill ${colorClass}"></i>`; } else if (rating >= i - 0.5) { stars += `<i class="bi bi-star-half ${colorClass}"></i>`; } else { stars += `<i class="bi bi-star ${colorClass}"></i>`; } } return stars; };

        // --- SALES TACTICS & COUNTDOWN ---
        let saleCountdownIntervals = {}; // Store intervals for each product to manage them individually

        const initializeCountdownTimers = () => {
            // Clear existing intervals to avoid multiple timers on the same elements after re-renders
            for (const key in saleCountdownIntervals) {
                clearInterval(saleCountdownIntervals[key]);
            }
            saleCountdownIntervals = {}; // Reset the storage

            const countdownElements = document.querySelectorAll('[data-sale-end]');
            
            countdownElements.forEach(el => {
                const productId = el.closest('.product-card')?.dataset.productId || el.closest('.product-view')?.dataset.productId; // Associate with product if possible
                const uniqueKey = productId || `global_sale_${Math.random()}`; // Unique key for each timer

                const updateSingleTimer = () => {
                    const endDate = new Date(el.dataset.saleEnd).getTime();
                    const now = new Date().getTime();
                    const distance = endDate - now;

                    if (distance < 0) {
                        el.innerHTML = "Sale Ended!";
                        el.closest('.product-card, .product-view')?.classList.remove('on-sale'); 
                        clearInterval(saleCountdownIntervals[uniqueKey]); // Stop this specific timer
                        delete saleCountdownIntervals[uniqueKey];
                        // Optionally re-render component if sale status changes
                        if (productId) {
                            const productCard = el.closest('.product-card');
                            if (productCard) {
                                // Find the product in the global products object and update its sale status
                                const p = products[productId];
                                if (p) {
                                    p.salePrice = null;
                                    p.saleEndDate = null;
                                    // You might trigger a re-render of this specific card if needed,
                                    // but full router() call handles it often.
                                }
                            }
                        }
                    } else {
                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                        el.innerHTML = `<i class="bi bi-fire me-1"></i> Sale ends in: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    }
                };

                // Store and start the interval for this specific element
                saleCountdownIntervals[uniqueKey] = setInterval(updateSingleTimer, 1000);
                updateSingleTimer(); // Initial call to display immediately
            });
        };

        const getProductPrice = (product) => {
            const now = new Date();
            const saleEndDate = product.saleEndDate ? new Date(product.saleEndDate) : null;
            const isSaleActive = product.salePrice && saleEndDate && saleEndDate > now;
            return {
                displayPrice: isSaleActive ? product.salePrice : product.price,
                originalPrice: product.price,
                isSaleActive: isSaleActive
            };
        };

        // --- CART, WISHLIST & AUTH FUNCTIONS ---
        const syncCartWithFirebase = () => { if (currentUser) { const db = getDatabase(); const cartWithTimestamp = { items: cart, lastUpdated: serverTimestamp() }; set(ref(db, `userCarts/${currentUser.uid}`), cart.length > 0 ? cartWithTimestamp : null); }};
        const updateCartUI = () => { localStorage.setItem('cart', JSON.stringify(cart)); localStorage.setItem('cartLastUpdated', new Date().getTime()); const badge = document.getElementById('cart-count-badge'); const mobileBadge = document.getElementById('mobile-cart-count-badge'); badge.textContent = cart.length; mobileBadge.textContent = cart.length; badge.style.display = cart.length > 0 ? 'block' : 'none'; mobileBadge.style.display = cart.length > 0 ? 'block' : 'none'; syncCartWithFirebase(); };
        const updateWishlistUI = () => { localStorage.setItem('wishlist', JSON.stringify(wishlist)); const badge = document.getElementById('wishlist-count-badge'); badge.textContent = wishlist.length; badge.style.display = wishlist.length > 0 ? 'block' : 'none'; };
        window.addToCart = (id) => { const p = products[id]; if (!p) return; const priceInfo = getProductPrice(p); if (priceInfo.displayPrice === 0) { document.getElementById('download-content').innerHTML = `<p class="lead">Enjoy your free product!</p><a href="${p.fileUrl}" class="btn btn-lg btn-success" target="_blank" download><i class="bi bi-download me-2"></i>Download: ${p.name}</a>`; downloadModal.show(); celebrate(); return; } if (!cart.find(item => item.id === id)) { cart.push({ id }); updateCartUI(); showToast(`Added to cart!`, 'success'); } else { showToast('Item already in cart', 'info'); }};
        window.buyNow = (id) => {
            console.log(`buyNow called for product ID: ${id}`);
            const productAlreadyInCart = cart.find(item => item.id === id);
            
            if (products[id]) { // Ensure product data is loaded
                if (!productAlreadyInCart) {
                    addToCart(id); // This will add to cart, update UI, and show toast
                } else {
                    showToast('Item already in cart', 'info');
                }
            } else {
                console.error(`Product data not found for ID: ${id}`);
                showToast('Product data not loaded. Please try again.', 'danger');
                return;
            }

            // After adding/confirming product in cart, navigate to cart view.
            // If already on #cart, force a re-render. Otherwise, change hash to trigger router.
            if (window.location.hash === '#cart') {
                console.log('Already on cart page, re-rendering cart view.');
                renderCartView(); 
            } else {
                console.log('Navigating to cart page.');
                window.location.hash = '#cart'; 
            }
        };
        window.removeFromCart = (id) => { cart = cart.filter(item => item.id !== id); appliedCoupon = null; updateCartUI(); renderCartView(); };
        window.toggleWishlist = (id) => { const index = wishlist.findIndex(item => item.id === id); if (index > -1) { wishlist.splice(index, 1); showToast('Removed from wishlist', 'info'); } else { wishlist.push({ id }); showToast('Added to wishlist!', 'success'); } updateWishlistUI(); const currentViewId = document.querySelector('.view.active')?.id; if (['home-view', 'products-view', 'product-view', 'wishlist-view'].includes(currentViewId)) { router(); } };
        window.applyCoupon = async (code) => { const couponInput = document.getElementById('coupon-code'); if (couponInput) couponInput.value = code; let allCoupons = { ...availableCoupons }; if (currentUser) { const db = getDatabase(); const userSnap = await get(ref(db, `users/${currentUser.uid}/coupons`)); if (userSnap.exists()) { allCoupons = { ...allCoupons, ...userSnap.val() }; } } if (allCoupons[code]) { let discountValue = allCoupons[code]; if (typeof discountValue === 'object' && discountValue.discount) { discountValue = discountValue.discount; } if (typeof discountValue !== 'number') { appliedCoupon = null; showToast("Invalid coupon data.", 'danger'); renderCartView(); return; } appliedCoupon = { code: code, discount: discountValue }; showToast(`Coupon "${code}" applied!`, 'success'); celebrateCoupon(); } else { appliedCoupon = null; showToast("Invalid coupon code.", 'danger'); } renderCartView(); };
        const updateAuthUI = (user) => { const authNavSection = document.getElementById('auth-nav-section'); const mobileProfileLink = document.querySelector('.mobile-nav-item[data-nav="profile"]'); if (user) { authNavSection.innerHTML = `<div class="dropdown"><button class="btn nav-action-btn dropdown-toggle d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-person-circle fs-5"></i> <span class="d-none d-lg-inline">${user.displayName || 'Profile'}</span></button><ul class="dropdown-menu dropdown-menu-end mt-2"><li><a class="dropdown-item" href="#profile"><i class="bi bi-person-fill me-2"></i> My Profile</a></li><li><a class="dropdown-item" href="#wishlist"><i class="bi bi-heart-fill me-2"></i> My Wishlist</a></li><li><a class="dropdown-item" href="#profile" onclick="document.getElementById('my-coupons-card')?.scrollIntoView({behavior: 'smooth'})"><i class="bi bi-ticket-percent-fill me-2"></i> My Coupons</a></li><li><a class="dropdown-item" href="#profile" onclick="document.getElementById('redeem-code-card')?.scrollIntoView({behavior: 'smooth'})"><i class="bi bi-tags-fill me-2"></i> Redeem Code</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="#" id="logout-btn"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li></ul></div>`; document.getElementById('logout-btn').addEventListener('click', handleLogout); mobileProfileLink.innerHTML = `<i class="bi bi-person-fill"></i><span>Profile</span>`; mobileProfileLink.href = '#profile'; } else { authNavSection.innerHTML = `<button id="login-btn" class="btn nav-action-btn"><i class="bi bi-box-arrow-in-right me-lg-2"></i><span class="d-none d-lg-inline">Login</span></button>`; document.getElementById('login-btn').addEventListener('click', () => renderAuthModal('login')); mobileProfileLink.innerHTML = `<i class="bi bi-box-arrow-in-right"></i><span>Login</span>`; mobileProfileLink.href = '#'; mobileProfileLink.onclick = (e) => { e.preventDefault(); renderAuthModal('login'); }; } };
        window.checkPasswordStrength = (password) => { const strengthBar = document.getElementById('strength-bar'); const strengthText = document.getElementById('strength-text'); const reqList = document.getElementById('requirement-list'); const submitBtn = document.getElementById('register-submit-btn'); let score = 0; const requirements = { length: password.length >= 8, uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), number: /[0-9]/.test(password), special: /[^A-Za-z0-9]/.test(password) }; for (const req in requirements) { const el = reqList.querySelector(`[data-requirement="${req}"]`); const icon = el.querySelector('i'); if (requirements[req]) { score++; el.classList.remove('invalid'); el.classList.add('valid'); icon.className = 'bi bi-check-circle-fill me-2'; } else { el.classList.remove('valid'); el.classList.add('invalid'); icon.className = 'bi bi-x-circle me-2'; } } let strength = { text: 'Weak', color: 'bg-danger', width: '20%' }; if (score >= 5) strength = { text: 'Very Strong', color: 'bg-success', width: '100%' }; else if (score >= 4) strength = { text: 'Strong', color: 'bg-success', width: '80%' }; else if (score >= 3) strength = { text: 'Medium', color: 'bg-warning', width: '60%' }; else if (score > 0) strength = { text: 'Weak', color: 'bg-danger', width: '40%' }; strengthBar.className = `progress-bar ${strength.color}`; strengthBar.style.width = strength.width; strengthText.textContent = `Strength: ${strength.text}`; strengthText.className = `small mt-1 mb-2 text-${strength.color.replace('bg-','')}`; submitBtn.disabled = score < 3; };
        window.renderAuthModal = (state = 'login') => {
            const contentEl = document.getElementById('auth-modal-content');
            let html = '';
            if (state === 'login') {
                html = `
                    <div class="modal-header border-0 pb-0">
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4 pt-2">
                        <div class="text-center mb-4">
                            <i class="bi bi-person-circle display-3 text-primary"></i>
                            <h3 class="mt-2">Welcome Back!</h3>
                            <p class="text-muted">Login to access your account and downloads.</p>
                        </div>
                        <form id="login-form">
                            <div class="form-floating mb-3">
                                <input type="email" class="form-control" id="login-email" placeholder="name@example.com" required>
                                <label for="login-email">Email Address</label>
                            </div>
                            <div class="form-floating mb-2">
                                <input type="password" class="form-control" id="login-password" placeholder="Password" required>
                                <label for="login-password">Password</label>
                            </div>
                            <div class="text-end mb-3">
                                <a href="#" onclick="renderAuthModal('forgot')" class="small text-decoration-none">Forgot Password?</a>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">Login</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer border-0 justify-content-center bg-body-tertiary">
                       <p class="text-muted mb-0">Don't have an account? <a href="#" onclick="renderAuthModal('register')" class="fw-bold text-decoration-none">Sign Up</a></p>
                    </div>`;
            } else if (state === 'register') {
                html = `<div class="modal-header border-0"><h5 class="modal-title">Create Account</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="register-form"><div class="mb-3"><label class="form-label">Full Name</label><input type="text" id="register-name" class="form-control" required></div><div class="mb-3"><label class="form-label">Email</label><input type="email" id="register-email" class="form-control" required></div><div class="mb-3"><label class="form-label">Password</label><input type="password" id="register-password" class="form-control" required aria-describedby="password-strength-meter"><div id="password-strength-meter" class="mt-2" style="display: none;"><div class="progress" style="height: 5px;"><div id="strength-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div></div><p id="strength-text" class="small mt-1 mb-2"></p><ul id="requirement-list" class="list-unstyled small"><li data-requirement="length"><i class="bi bi-x-circle me-2"></i>At least 8 characters</li><li data-requirement="uppercase"><i class="bi bi-x-circle me-2"></i>At least 1 uppercase letter</li><li data-requirement="lowercase"><i class="bi bi-x-circle me-2"></i>At least 1 lowercase letter</li><li data-requirement="number"><i class="bi bi-x-circle me-2"></i>At least 1 number</li><li data-requirement="special"><i class="bi bi-x-circle me-2"></i>At least 1 special character</li></ul></div></div><button type="submit" id="register-submit-btn" class="btn btn-primary w-100" disabled>Register</button></form></div><div class="modal-footer border-0 justify-content-center"><a href="#" onclick="renderAuthModal('login')">Already have an account? Login</a></div>`;
            } else if (state === 'forgot') {
                html = `<div class="modal-header border-0"><h5 class="modal-title">Reset Password</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p class="text-muted">Enter your email and we'll send you a link to reset your password.</p><form id="forgot-form"><div class="mb-3"><label class="form-label">Email</label><input type="email" id="forgot-email" class="form-control" required></div><button type="submit" class="btn btn-primary w-100">Send Reset Link</button></form></div><div class="modal-footer border-0 justify-content-center"><a href="#" onclick="renderAuthModal('login')">Back to Login</a></div>`;
            } else if (state === 'verify') {
                html = `<div class="modal-header border-0"><h5 class="modal-title">Verify Your Email</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center"><i class="bi bi-envelope-check-fill text-primary display-3"></i><h4 class="mt-3">Please verify your email address.</h4><p class="text-muted">We've sent a verification link to your inbox. Please click the link to continue.</p><p class="text-muted small"><strong>Important: Please also check your spam, junk, or promotions folder!</strong></p><button id="resend-verification-btn" class="btn btn-outline-primary">Resend Verification Email</button></div>`;
            }
            contentEl.innerHTML = html;
            authModal.show();
            if (state === 'login') document.getElementById('login-form').addEventListener('submit', handleLogin);
            if (state === 'register') {
                document.getElementById('register-form').addEventListener('submit', handleRegister);
                const pwdInput = document.getElementById('register-password');
                const meter = document.getElementById('password-strength-meter');
                pwdInput.addEventListener('keyup', () => { meter.style.display = pwdInput.value ? 'block' : 'none'; checkPasswordStrength(pwdInput.value); });
            }
            if (state === 'forgot') document.getElementById('forgot-form').addEventListener('submit', handleForgotPassword);
            if (state === 'verify') document.getElementById('resend-verification-btn').addEventListener('click', () => { if (currentUser) { sendEmailVerification(currentUser).then(() => showToast('Verification email resent! Check your inbox & spam folder.', 'info')).catch(err => { console.error("Resend Verification Error:", err); showToast(`Failed to resend email: ${err.message.replace('Firebase: ','')}`, 'danger'); }); } });
        };
        const handleLogin = (e) => { e.preventDefault(); const auth = getAuth(); signInWithEmailAndPassword(auth, e.target['login-email'].value, e.target['login-password'].value).then((userCredential) => { if (!userCredential.user.emailVerified) { authModal.hide(); renderAuthModal('verify'); return; } authModal.hide(); showToast('Login Successful!', 'success'); if (checkoutAfterLogin) { checkoutAfterLogin = false; handleCheckout(new Event('submit')); } }).catch(err => showToast(`Login failed: ${err.message.replace('Firebase: ','')}`, 'danger')); };
        const handleRegister = (e) => { e.preventDefault(); const auth = getAuth(); const name = e.target['register-name'].value; const email = e.target['register-email'].value; const password = e.target['register-password'].value; createUserWithEmailAndPassword(auth, email, password).then(userCredential => { const user = userCredential.user; const profilePromise = updateProfile(user, { displayName: name }); const verificationPromise = sendEmailVerification(user).catch(err => console.error("Error sending verification email:", err)); localStorage.setItem('showReferralPopup', 'true'); const db = getDatabase(); const referralCode = (name.substring(0, 4).toUpperCase() || 'USER') + user.uid.substring(0, 4).toUpperCase(); const updates = {}; updates[`/users/${user.uid}/referralCode`] = referralCode; updates[`/referralCodes/${referralCode}`] = { uid: user.uid }; const dbPromise = update(ref(db), updates); return Promise.all([profilePromise, dbPromise, verificationPromise]); }).then(() => { authModal.hide(); showToast('Registration successful! Please check your email (and spam folder) to verify your account.', 'success', 7000); }).catch(err => { showToast(`Registration failed: ${err.message.replace('Firebase: ','')}`, 'danger'); }); };
        const handleForgotPassword = (e) => { e.preventDefault(); const auth = getAuth(); sendPasswordResetEmail(auth, e.target['forgot-email'].value).then(() => { renderAuthModal('login'); showToast('Password reset email sent!', 'info'); }).catch(err => showToast(`Error: ${err.message.replace('Firebase: ','')}`, 'danger')); };
        const handleLogout = (e) => { e.preventDefault(); signOut(getAuth()).then(() => { showToast('You have been logged out', 'info'); window.location.hash = '#home'; }).catch(err => showToast(`Logout error: ${err.message}`, 'danger')); };
        const handleUpdateProfile = (e) => { e.preventDefault(); const newName = document.getElementById('update-name-input').value; if (!newName || newName === currentUser.displayName) return; updateProfile(currentUser, { displayName: newName }).then(() => { showToast('Profile updated successfully!', 'success'); renderProfileView(); updateAuthUI(currentUser); }).catch(err => showToast(`Error updating profile: ${err.message}`, 'danger')); };
        
        // Function to copy coupon code
        window.copyCouponCode = (code) => {
            navigator.clipboard.writeText(code).then(() => {
                showToast('Coupon code copied!', 'info');
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                showToast('Failed to copy code.', 'danger');
            });
        };

        // --- VIEW RENDERING ---
        const renderProductCard = ([id, p]) => {
            const priceInfo = getProductPrice(p);
            let priceHTML = '';
            if (priceInfo.isSaleActive) {
                const discount = Math.round(((p.price - p.salePrice) / p.price) * 100);
                priceHTML = `<div class="d-flex justify-content-between align-items-center mb-2">
                                <div><span class="h5 fw-bold" style="color: var(--danger-color);">â¹${p.salePrice}</span> <del class="text-muted ms-1">â¹${p.price}</del></div>
                                <span class="discount-badge">${discount}% OFF</span>
                             </div>`;
            } else if (p.mrp && p.mrp > p.price) {
                const discount = Math.round(((p.mrp - p.price) / p.mrp) * 100);
                priceHTML = `<div class="d-flex justify-content-between align-items-center mb-2">
                                <div><span class="h5 fw-bold" style="color: var(--primary-color);">â¹${p.price}</span> <del class="text-muted ms-1">â¹${p.mrp}</del></div>
                                <span class="discount-badge">${discount}% OFF</span>
                            </div>`;
            } else {
                priceHTML = `<div class="mb-2"><p class="h5 fw-bold mb-0" style="color: var(--primary-color);">${p.price > 0 ? `â¹${p.price}` : 'Free'}</p></div>`;
            }
            
            const limitedStockHTML = p.stock && p.stock > 0 && p.stock < 10 ? `<span class="limited-stock-badge me-2">Only ${p.stock} left!</span>` : '';
            const countdownHTML = priceInfo.isSaleActive ? `<div class="product-countdown-timer" data-sale-end="${p.saleEndDate}" data-product-id="${id}"><i class="bi bi-fire me-1"></i>Sale ends in: Loading...</div>` : '';

            return `<div class="col">
                        <div class="card product-card h-100" data-product-id="${id}">
                            <button class="btn btn-sm wishlist-btn" onclick="toggleWishlist('${id}')" title="Add to Wishlist"><i class="bi ${wishlist.some(item => item.id === id) ? 'bi-heart-fill' : 'bi-heart'}"></i></button>
                            <!-- IMPROVED: Wrapped main content in clickable link area -->
                            <a href="#product/${id}" class="card-link-area">
                                <div class="card-img-container">
                                    ${p.category ? `<span class="product-tag">${p.category}</span>` : ''}
                                    <img src="${p.imageUrl}" class="card-img-top" alt="${p.name}">
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">${p.name}</h5>
                                    <p class="card-text small text-muted flex-grow-1">${(p.subtitle || '').substring(0, 70)}${(p.subtitle && p.subtitle.length > 70) ? '...' : ''}</p>
                                    <div class="mt-auto">
                                        ${priceHTML}
                                        <div class="d-flex justify-content-start align-items-center mb-2">${limitedStockHTML}</div>
                                    </div>
                                </div>
                            </a>
                            <div class="card-footer bg-transparent border-0 pt-0 pb-3 px-3">
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm w-100 btn-success" onclick="buyNow('${id}')">Buy Now</button>
                                    <button class="btn btn-sm btn-primary w-100" onclick="addToCart('${id}')">${priceInfo.displayPrice > 0 ? 'Add to Cart' : 'Get for Free'}</button>
                                </div>
                            </div>
                            ${countdownHTML}
                        </div>
                    </div>`;
        };
        const animateCounter = (element, target) => { if (target <= 0) { element.textContent = target; return; } let count = 0; const duration = 2000; const stepTime = Math.abs(Math.floor(duration / target)); const timer = setInterval(() => { count++; element.textContent = count; if (count >= target) { clearInterval(timer); element.textContent = target; } }, stepTime); };
        const animateCounterOnScroll = () => { const statsSection = document.getElementById('stats-section'); if (!statsSection) return; const observer = new IntersectionObserver((entries) => { if (entries[0].isIntersecting) { document.querySelectorAll('.stats-counter').forEach(counter => { if (counter.textContent === '0') { const target = +counter.dataset.target; animateCounter(counter, target); } }); observer.disconnect(); } }, { threshold: 0.5 }); observer.observe(statsSection); };
        
        // REVERTED: renderTestimonials now uses Swiper.js again
        const renderTestimonials = () => { 
            const testimonials = [ 
                { name: "Sameer K.", rating: 5, text: "Bhai, source code ekdum clean aur well-commented tha. Weeks ka kaam ghanto mein ho gaya. Seriously, paisa wasool!" }, 
                { name: "Aisha R.", rating: 5, text: "Video editing assets bohot hi creative hain. Mere reels aur videos pehle se 10x better lag rahe hain. Thank you, Enough Editor!" }, 
                { name: "Rahul 'CodeDev'", rating: 4, text: "Website template use kiya for a client project. Responsive design aur features ne dil jeet liya. Thoda customization karna pada but overall superb." }, 
                { name: "Pooja S.", rating: 5, text: "As a freelancer, ye assets life-saver hain. Quality top-notch hai aur delivery instant. Ab har project ke liye yahin se start karti hoon." }, 
                { name: "Ravi G.", rating: 4, text: "Giveaway jeeta tha! Product sach me premium hai. Customer support bhi kaafi friendly aur quick hai. Bohot badiya kaam kar rahe ho, guys!" }, 
                { name: "Ankit 'WebMaster'", rating: 5, text: "Maza aa gaya bhai! Code itna organized hai ki debugging ki zarurat hi nahi padi. Future projects ke liye fix hai, yahin se lunga sab kuch." } 
            ]; 
            // Reverted to Swiper.js slide structure
            const slides = testimonials.map(t => `
                <div class="swiper-slide">
                    <div class="testimonial-card">
                        <div class="testimonial-text">â${t.text}â</div>
                        <div class="testimonial-author">
                            <div class="testimonial-author-icon"><i class="bi bi-person-fill fs-3"></i></div>
                            <div class="testimonial-author-info">
                                <h6>${t.name}</h6>
                                <div class="testimonial-stars">${renderStars(t.rating)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join(''); 

            return `
                <section class="section testimonials-section"> 
                    <div class="container"> 
                        <h2 class="section-title text-center">What Our Users Say</h2> 
                        <p class="section-subtitle">We're proud to have helped thousands of creators. Here's what they think about us.</p> 
                        <div class="swiper testimonials-swiper"> 
                            <div class="swiper-wrapper">${slides}</div> 
                            <div class="swiper-pagination"></div> 
                        </div> 
                    </div> 
                </section>
            `; 
        };

        const renderRecentlyViewed = () => { if (recentlyViewed.length === 0) return ''; const items = recentlyViewed.map(id => [id, products[id]]).filter(([, p]) => p); if (items.length === 0) return ''; return `<section class="section container"> <h2 class="section-title text-center">Recently Viewed</h2> <div class="row row-cols-2 row-cols-lg-5 g-4">${items.map(renderProductCard).join('')}</div> </section>`; };
        // REMOVED: renderCartUpsell function removed as requested.

        // Render Sale Alert Section
        const renderSaleAlertSection = () => {
            const saleProducts = Object.entries(products).filter(([, p]) => getProductPrice(p).isSaleActive);
            if (saleProducts.length === 0) return '';

            const slicedProducts = saleProducts.slice(0, 4); // Show up to 4 products

            return `<section class="section container text-center">
                        <h2 class="section-title text-primary">Limited Time Deals!</h2>
                        <p class="section-subtitle">Grab these high-quality products at discounted prices before the sale ends!</p>
                        <div class="row row-cols-2 row-cols-lg-4 g-4">
                            ${slicedProducts.map(renderProductCard).join('')}
                        </div>
                        <div class="mt-5">
                            <a href="#products/sale" class="btn btn-outline-danger btn-lg">View All Sale Items <i class="bi bi-arrow-right-short"></i></a>
                        </div>
                    </section>`;
        };

        const renderHomeView = () => { 
            updateSchema({ "@context": "https://schema.org", "@type": "WebSite", "url": `${BASE_URL}/`, "name": "Enough Editor", "potentialAction": { "@type": "SearchAction", "target": `${BASE_URL}/#products?q={search_term_string}`, "query-input": "required name=search_term_string" } }, 'website-schema'); 
            
            const newlyListedProducts = Object.entries(products).sort(([,a],[,b]) => (b.timestamp || 0) - (a.timestamp || 0)).slice(0, 4); 
            const paymentLogosHTML = `<div class="payment-method-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Google_Pay_Logo.svg/1200px-Google_Pay_Logo.svg.png" alt="Google Pay Logo"></div><div class="payment-method-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/UPI-Logo-vector.svg/2560px-UPI-vector.svg.png" alt="UPI Logo"></div><div class="payment-method-logo"><img src="https://images.ctfassets.net/v2a2klvd105s/5dgVKvuuqzXIkJ19HF04dT/77f3d3c9da730bb4cfc8c991af30c899/phonepe-logo.png" alt="PhonePe Logo"></div><div class="payment-method-logo"><img src="https://images.ctfassets.net/v2a2klvd105s/ZRXNXVeR5y3mI7DbgvZOM/4740573501f3f88c120ebc6b14303c35/download__1_.png" alt="Paytm Logo"></div>`; 
            
            document.getElementById('home-view').innerHTML = `
                <section class="hero-section">
                    <div class="container">
                        <div class="row align-items-center g-5">
                            <div class="col-lg-6">
                                <span class="hero-badge"><i class="bi bi-stars me-1"></i> Welcome to Enough Editor</span>
                                <h1 class="display-3 mb-3">Premium Assets for<br><span class="text-primary">Modern Creators.</span></h1>
                                <p class="lead text-muted mb-4">High-quality source codes, website templates, and editing assets to bring your vision to life.</p>
                                <div class="d-flex flex-wrap gap-3 mb-4"><a href="#products" class="btn btn-primary btn-lg px-4">Explore Products</a></div>
                                <div class="d-flex flex-wrap gap-4">
                                    <span class="trust-badge"><i class="bi bi-patch-check-fill text-success"></i> Premium Quality</span>
                                    <span class="trust-badge"><i class="bi bi-lightning-charge-fill text-warning"></i> Instant Delivery</span>
                                    <span class="trust-badge"><i class="bi bi-lock-fill text-info"></i> Secure Checkout</span>
                                    <!-- NEW: Lifetime Access added to hero section -->
                                    <span class="trust-badge"><i class="bi bi-infinity text-primary"></i> Lifetime Access</span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="hero-graphic"><div class="secondary-shape"></div><div class="main-shape"></div></div>
                            </div>
                        </div>
                        <div class="scroll-prompt d-none d-md-block">Scroll for more <i class="bi bi-arrow-down"></i></div>
                    </div>
                </section>
                ${renderSaleAlertSection()} 
                <section class="section container text-center">
                    <h2 class="section-title">Newly Listed Products</h2> 
                    <p class="section-subtitle">High-quality assets to accelerate your projects. Here are some of our newest additions.</p>
                    <div class="row row-cols-2 row-cols-lg-4 g-4">${newlyListedProducts.map(renderProductCard).join('')}</div>
                    <div class="mt-5"><a href="#products" class="btn btn-outline-primary btn-lg">View All Products</a></div>
                </section>
                ${renderRecentlyViewed()}
                <section class="section text-center" style="background-color: var(--card-bg);">
                    <div class="container">
                        <h2 class="section-title">Why Choose Us?</h2>
                        <p class="section-subtitle">Experience premium digital products with unmatched quality and support.</p>
                        <div class="row g-4 text-start">
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-lightning-charge-fill"></i></div><div><h3>Superfast Delivery</h3><p class="text-muted">Get instant access to all digital products via email and dashboard.</p></div></div></div>
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-shield-check"></i></div><div><h3>100% Safe & Verified</h3><p class="text-muted">We deliver only safe, scanned, and verified products.</p></div></div></div>
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-gem"></i></div><div><h3>Premium Quality</h3><p class="text-muted">Every product is crafted with care to ensure the highest quality.</p></div></div></div>
                            <!-- NEW FEATURES ADDED BELOW -->
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-headset"></i></div><div><h3>Fast & Dedicated Support</h3><p class="text-muted">Our team is always ready to assist you with any questions.</p></div></div></div>
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-arrow-repeat"></i></div><div><h3>Regular Updates & New Assets</h3><p class="text-muted">We continuously add new and update existing products.</p></div></div></div>
                            <div class="col-md-6 col-lg-4 feature-item"><div class="d-flex gap-3"><div><i class="bi bi-currency-rupee"></i></div><div><h3>Cost-Effective Solutions</h3><p class="text-muted">Get high-quality assets without breaking the bank.</p></div></div></div>
                            <!-- Lifetime Access REMOVED from here as per request -->
                        </div>
                    </div>
                </section>
                <section class="section" id="stats-section">
                    <div class="container">
                        <h2 class="section-title">Our Impact</h2>
                        <p class="section-subtitle">We're proud of the community we've built and the creators we've helped.</p>
                        <div class="row text-center g-4">
                            <div class="col-6 col-md-3"><div class="p-4 rounded-3 h-100" style="background-color: var(--card-bg); border: 1px solid var(--border-color);"><i class="bi bi-cloud-arrow-down-fill display-4 text-primary"></i><h3 class="mt-2 display-4 fw-bold"><span class="stats-counter" data-target="172">0</span>+</h3><p class="text-muted mb-0 fs-5">Downloads</p></div></div>
                            <div class="col-6 col-md-3"><div class="p-4 rounded-3 h-100" style="background-color: var(--card-bg); border: 1px solid var(--border-color);"><i class="bi bi-star-fill display-4 text-warning"></i><h3 class="mt-2 display-4 fw-bold">4.4<span class="fs-4 text-muted">/5</span></h3><p class="text-muted mb-0 fs-5">User Rating</p></div></div>
                            <div class="col-6 col-md-3"><div class="p-4 rounded-3 h-100" style="background-color: var(--card-bg); border: 1px solid var(--border-color);"><i class="bi bi-box-seam-fill display-4 text-success"></i><h3 class="mt-2 display-4 fw-bold"><span class="stats-counter" data-target="${Object.keys(products).length}">0</span>+</h3><p class="text-muted mb-0 fs-5">Products</p></div></div>
                            <div class="col-6 col-md-3"><div class="p-4 rounded-3 h-100" style="background-color: var(--card-bg); border: 1px solid var(--border-color);"><i class="bi bi-calendar-check-fill display-4 text-info"></i><h3 class="mt-2 display-4 fw-bold"><span class="stats-counter" data-target="4">0</span>+</h3><p class="text-muted mb-0 fs-5">Years Experience</p></div></div>
                        </div>
                    </div>
                </section>
                ${renderTestimonials()} 
                <section class="section payment-section text-center">
                    <div class="container">
                        <h2 class="section-title">Trusted & Secure Payments</h2>
                        <p class="section-subtitle">We partner with Razorpay to offer secure and reliable payment processing. Your transactions are safe with us.</p>
                        <div class="main-payment-logo-container"><img src="https://images.ctfassets.net/v2a2klvd105s/01eGEKr0wer0tCHfeRhUQ1/a0eee200a72c5b9170c5ac35eba5934c/razorpay-with-all-cards-upi-logo-png_seeklogo-360257.png" alt="Razorpay Payment Partner and supported cards"></div>
                        <div class="logo-scroller"><div class="logo-scroller-inner">${paymentLogosHTML.repeat(2)}</div></div>
                    </div>
                </section>`; 
            initializeCountdownTimers(); animateCounterOnScroll(); 
            // Re-initialize Swiper for testimonials after they are rendered
            if (testimonialSwiper) testimonialSwiper.destroy(true, true); // Destroy existing instance if any
            testimonialSwiper = new Swiper('.testimonials-swiper', { 
                loop: true, 
                autoplay: { 
                    delay: 4500, 
                    disableOnInteraction: false 
                }, 
                slidesPerView: 1.2, 
                spaceBetween: 15, 
                centeredSlides: true, 
                pagination: { el: '.swiper-pagination', clickable: true }, 
                breakpoints: { 
                    768: { slidesPerView: 2.5, spaceBetween: 20 }, 
                    992: { slidesPerView: 3.5, spaceBetween: 30 } 
                } 
            }); 
        };

        const renderProductsView = (showSaleOnly = false) => { 
            updateSchema(null, 'product-schema'); 
            const view = document.getElementById('products-view'); 
            const categories = ['All', ...new Set(Object.values(products).map(p => p.category).filter(Boolean).sort())]; 
            
            // Update filter state based on call
            filters.onSaleOnly = showSaleOnly;

            const desktopFiltersHTML = `
                <div class="d-none d-lg-block" style="background-color: var(--card-bg); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border: 1px solid var(--border-color);">
                    <div class="row g-3 align-items-end">
                        <div class="col-lg-4 col-md-12">
                            <label class="form-label">Search</label>
                            <input type="search" class="form-control search-input" placeholder="e.g., Video Editing Pack" list="product-suggestions">
                        </div>
                        <div class="col-lg-2 col-md-4">
                            <label class="form-label">Min Price</label>
                            <input type="number" class="form-control min-price-input" placeholder="â¹0">
                        </div>
                        <div class="col-lg-2 col-md-4">
                            <label class="form-label">Max Price</label>
                            <input type="number" class="form-control max-price-input" placeholder="Any">
                        </div>
                        <div class="col-lg-2 col-md-4">
                            <label class="form-label">Category</label>
                            <select class="form-select category-select">
                                ${categories.map(cat => `<option value="${cat}" ${filters.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-4">
                            <label class="form-label">Sort By</label>
                            <select class="form-select sort-by-select">
                                <option value="newest">Newest</option>
                                <option value="price_asc">Price: Low to High</option>
                                <option value="price_desc">Price: High to Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-check form-switch mt-3">
                        <input class="form-check-input" type="checkbox" id="sale-only-filter" ${filters.onSaleOnly ? 'checked' : ''}>
                        <label class="form-check-label" for="sale-only-filter">Show Only Sale Items</label>
                    </div>
                </div>`; 
            const mobileFiltersHTML = `
                <div class="d-lg-none input-group mb-4">
                    <input type="search" class="form-control search-input" placeholder="Search products..." list="product-suggestions">
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas"><i class="bi bi-funnel-fill"></i></button>
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#sortOffcanvas"><i class="bi bi-arrow-down-up"></i></button>
                </div>`; 
            const categoryFiltersHTML = ``; // Categories moved into desktop filter row and mobile offcanvas
            const suggestionsHTML = `<datalist id="product-suggestions">${Object.values(products).map(p => `<option value="${p.name}"></option>`).join('')}</datalist>`; 
            
            view.innerHTML = `
                <div class="text-center mb-5">
                    <h1 class="section-title">${showSaleOnly ? 'Sale Items' : 'All Products'}</h1>
                    <p class="section-subtitle">${showSaleOnly ? 'Limited time offers! Grab your deals before they are gone.' : 'Find the perfect asset, template, or code for your next project.'}</p>
                </div>
                ${desktopFiltersHTML}
                ${mobileFiltersHTML}
                ${categoryFiltersHTML}
                <div id="product-list" class="row row-cols-2 row-cols-lg-3 row-cols-xl-4 g-4"></div>
                ${suggestionsHTML}`; 
            
            const renderList = () => { 
                const listEl = document.getElementById('product-list'); 
                let filtered = Object.entries(products); 
                
                if (filters.search) { 
                    filtered = filtered.filter(([id, p]) => p.name.toLowerCase().includes(filters.search.toLowerCase()) || p.subtitle?.toLowerCase().includes(filters.search.toLowerCase())); 
                } 
                if (filters.category !== 'All' && filters.category !== undefined) { 
                    filtered = filtered.filter(([, p]) => p.category === filters.category); 
                } 
                filtered = filtered.filter(([, p]) => { 
                    const priceInfo = getProductPrice(p); 
                    return priceInfo.displayPrice >= (filters.minPrice ?? 0) && priceInfo.displayPrice <= (filters.maxPrice ?? 999999); 
                }); 

                if (filters.onSaleOnly) { 
                    filtered = filtered.filter(([,p]) => getProductPrice(p).isSaleActive);
                }

                switch (filters.sortBy) { 
                    case 'price_asc': filtered.sort(([, a], [, b]) => getProductPrice(a).displayPrice - getProductPrice(b).displayPrice); break; 
                    case 'price_desc': filtered.sort(([, a], [, b]) => getProductPrice(b).displayPrice - getProductPrice(a).displayPrice); break; 
                    default: filtered.sort(([, a], [, b]) => (b.timestamp || 0) - (a.timestamp || 0)); break; 
                } 
                listEl.innerHTML = filtered.length ? filtered.map(renderProductCard).join('') : `<div class="col-12 text-center py-5"><i class="bi bi-search-heart display-1 text-muted"></i><h4 class="text-muted mt-3">No products found.</h4><p class="text-muted">Try adjusting your search or filters.</p></div>`; 
                initializeCountdownTimers(); 
            }; 
            
            const updateFilterUI = () => { 
                document.querySelectorAll('.search-input').forEach(i => i.value = filters.search); 
                document.querySelectorAll('.min-price-input').forEach(i => i.value = filters.minPrice); 
                document.querySelectorAll('.max-price-input').forEach(i => i.value = filters.maxPrice); 
                document.querySelectorAll('.sort-by-select').forEach(el => el.value = filters.sortBy); 
                document.querySelectorAll('.category-select').forEach(el => el.value = filters.category); 
                document.querySelectorAll('.category-filters .btn').forEach(btn => btn.classList.toggle('active', btn.dataset.category === filters.category)); 
                document.querySelectorAll('#sale-only-filter').forEach(checkbox => checkbox.checked = filters.onSaleOnly);
                // Also update radio buttons in sortOffcanvas for mobile
                document.querySelectorAll('.sort-by-radio').forEach(radio => radio.checked = (radio.value === filters.sortBy));
                document.querySelectorAll('.category-radio').forEach(radio => radio.checked = (radio.value === filters.category));

                // If onSaleOnly is true, disable/hide category and price filters
                if (filters.onSaleOnly) {
                    document.querySelectorAll('.min-price-input, .max-price-input, .category-select, .category-filters .btn').forEach(el => {
                        if (el.tagName === 'BUTTON') {
                            el.style.display = 'none'; // Hide category buttons
                        } else {
                             el.disabled = true; // Disable other inputs
                        }
                    });
                    document.querySelector('.category-select')?.closest('.col-lg-2')?.classList.add('d-none'); // Hide desktop category dropdown column
                } else {
                     document.querySelectorAll('.min-price-input, .max-price-input, .category-select, .category-filters .btn').forEach(el => {
                        if (el.tagName === 'BUTTON') {
                            el.style.display = ''; // Show category buttons
                        } else {
                            el.disabled = false; // Enable inputs
                        }
                    });
                    document.querySelector('.category-select')?.closest('.col-lg-2')?.classList.remove('d-none'); // Show desktop category dropdown column
                }

            }; 
            const setupFilterHandlers = () => { 
                document.querySelectorAll('.search-input').forEach(i => i.addEventListener('keyup', e => { filters.search = e.target.value; renderList(); updateFilterUI(); })); 
                document.querySelectorAll('.min-price-input').forEach(i => i.addEventListener('input', e => { filters.minPrice = e.target.value ? parseFloat(e.target.value) : null; renderList(); updateFilterUI(); })); 
                document.querySelectorAll('.max-price-input').forEach(i => i.addEventListener('input', e => { filters.maxPrice = e.target.value ? parseFloat(e.target.value) : null; renderList(); updateFilterUI(); })); 
                document.querySelectorAll('.sort-by-select').forEach(el => el.addEventListener('change', e => { filters.sortBy = e.target.value; renderList(); updateFilterUI(); })); 
                document.querySelectorAll('.category-select').forEach(el => el.addEventListener('change', e => { filters.category = e.target.value; renderList(); updateFilterUI(); })); 
                document.querySelectorAll('.category-filters .btn').forEach(btn => btn.addEventListener('click', e => { filters.category = e.target.dataset.category; renderList(); updateFilterUI(); if(filterOffcanvas) filterOffcanvas.hide(); })); 
                
                document.getElementById('sale-only-filter')?.addEventListener('change', e => {
                    filters.onSaleOnly = e.target.checked;
                    renderList();
                    updateFilterUI();
                });

                document.getElementById('apply-mobile-filters-btn')?.addEventListener('click', () => { renderList(); updateFilterUI(); filterOffcanvas.hide(); }); 
            }; 

            document.getElementById('filter-offcanvas-body').innerHTML = `
                <h5>Price Range</h5>
                <div class="row g-2 mb-3">
                    <div class="col"><input type="number" class="form-control min-price-input" placeholder="Min"></div>
                    <div class="col"><input type="number" class="form-control max-price-input" placeholder="Max"></div>
                </div>
                <h5>Categories</h5>
                <div class="list-group list-group-flush mb-3 category-filters-mobile">
                    ${categories.map(cat => `<label class="list-group-item"><input class="form-check-input me-2 category-radio" type="radio" name="category-mobile" value="${cat}">${cat}</label>`).join('')}
                </div>
                <div class="form-check form-switch mt-3">
                    <input class="form-check-input" type="checkbox" id="sale-only-filter-mobile" ${filters.onSaleOnly ? 'checked' : ''}>
                    <label class="form-check-label" for="sale-only-filter-mobile">Show Only Sale Items</label>
                </div>
                <div class="d-grid mt-4">
                    <button class="btn btn-primary" id="apply-mobile-filters-btn">Apply Filters</button>
                </div>`; 
            
            document.getElementById('sort-offcanvas-body').innerHTML = `
                <div class="list-group list-group-flush">
                    ${[{v:'newest',l:'Newest'},{v:'price_asc',l:'Price: Low to High'},{v:'price_desc',l:'Price: High to Low'}].map(o=>`<label class="list-group-item"><input class="form-check-input me-2 sort-by-radio" type="radio" name="sort" value="${o.v}">${o.l}</label>`).join('')}
                </div>`; 
            
            // Re-setup handlers for mobile offcanvas
            document.querySelectorAll('.category-filters-mobile .category-radio').forEach(radio => radio.addEventListener('change', e => { filters.category = e.target.value; }));
            document.getElementById('sale-only-filter-mobile')?.addEventListener('change', e => {
                filters.onSaleOnly = e.target.checked;
            });
            // These handlers will be called by 'apply-mobile-filters-btn'
            document.querySelectorAll('.min-price-input').forEach(i => i.addEventListener('input', e => { filters.minPrice = e.target.value ? parseFloat(e.target.value) : null; })); 
            document.querySelectorAll('.max-price-input').forEach(i => i.addEventListener('input', e => { filters.maxPrice = e.target.value ? parseFloat(e.target.value) : null; })); 
            document.querySelectorAll('.sort-by-radio').forEach(el => el.addEventListener('change', e => { filters.sortBy = e.target.value; }));

            renderList(); updateFilterUI(); setupFilterHandlers(); 
        };

        const renderCartView = async () => { 
            console.log('renderCartView called'); // Debugging: confirm function call
            updateSchema(null, 'product-schema'); 
            const view = document.getElementById('cart-view'); 
            const originalCartLength = cart.length; 
            cart = cart.filter(item => products[item.id]); // Ensures only valid products are in cart
            if (cart.length < originalCartLength) { 
                showToast('Some items in your cart were removed as they are no longer available.', 'warning'); 
                updateCartUI(); // Update UI after filtering invalid items
            } 
            if (!cart.length) { 
                appliedCoupon = null; 
                view.innerHTML = `<div class="text-center p-5 card"><div class="card-body"><i class="bi bi-cart-x-fill display-1 text-muted"></i><h1 class="display-5 mt-3">Your Cart is Empty</h1><p class="lead text-muted">Looks like you haven't added anything yet.</p><a href="#products" class="btn btn-primary mt-3">Continue Shopping</a></div></div>`; 
                return; 
            } 
            let itemsHtml = '', subtotal = 0; 
            cart.forEach(item => { 
                const p = products[item.id]; 
                if(p){ // Double check p exists
                    const priceInfo = getProductPrice(p); 
                    subtotal += priceInfo.displayPrice; 
                    itemsHtml += `<div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded" style="background-color: var(--secondary-bg);"><div class="d-flex align-items-center text-truncate gap-3"><img src="${p.imageUrl}" width="60" height="60" class="rounded object-fit-cover"><span class="fw-medium text-truncate">${p.name}</span></div><div class="d-flex align-items-center gap-3"><span class="fw-bold fs-5">â¹${priceInfo.displayPrice}</span><button class="btn btn-danger btn-sm" onclick="removeFromCart('${item.id}')" aria-label="Remove"><i class="bi bi-trash"></i></button></div></div>`; 
                }
            }); 
            let discountAmount = 0, finalTotal = subtotal; 
            let discountHtml = ''; // Ensure discountHtml is always defined
            if(appliedCoupon) { 
                discountAmount = (subtotal * (appliedCoupon.discount / 100)); 
                finalTotal = subtotal - discountAmount; 
                discountHtml = `<div class="d-flex justify-content-between mt-2 fw-medium text-success"><p>Discount (${appliedCoupon.code} - ${appliedCoupon.discount}%)</p><p>- â¹${discountAmount.toFixed(2)}</p></div>`; 
            }

            let displayCoupons = { ...availableCoupons }; 
            if (currentUser) { 
                const db = getDatabase(); 
                const userCouponsSnap = await get(ref(db, `users/${currentUser.uid}/coupons`)); 
                if (userCouponsSnap.exists()) { 
                    const userCoupons = userCouponsSnap.val(); 
                    for (const key in userCoupons) { 
                        if (new Date(userCoupons[key].expiry) > new Date()) { 
                            displayCoupons[key] = userCoupons[key].discount; 
                        } 
                    } 
                } 
            } 
            const couponBadges = Object.keys(displayCoupons).length > 0 ? Object.entries(displayCoupons).map(([code, percent]) => `<span class="badge rounded-pill p-2 me-2 mb-2" style="cursor: pointer; border: 1px dashed var(--primary-color); color: var(--primary-color);" onclick="applyCoupon('${code}')"><i class="bi bi-scissors me-1"></i>${code}</span>`).join('') : '<p class="text-muted small">No coupons available right now.</p>'; 
            const trustBadgesHTML = `<div class="mt-4 text-center"><div class="trust-badges-checkout"><span class="razorpay-secure-badge"><i class="bi bi-shield-check-fill me-1"></i> Razorpay Secure</span><span class="text-muted"><i class="bi bi-lock-fill me-1"></i> Secure Payment</span><span class="text-primary"><i class="bi bi-patch-check-fill me-1"></i> Verified Seller</span></div></div>`; 
            
            view.innerHTML = `<h1>Your Cart</h1><div class="row mt-4 g-4"><div class="col-lg-8"><div class="card"><div class="card-body p-4">${itemsHtml}</div></div></div><div class="col-lg-4"><div class="card sticky-top" style="top: 100px;"><div class="card-body p-4"><h3>Order Summary</h3><div class="d-flex justify-content-between mt-3"><p>Subtotal</p><p>â¹${subtotal.toFixed(2)}</p></div>${discountHtml}<hr><div class="d-flex justify-content-between mt-2"><p class="h5">Total</p><p class="fw-bold fs-5">â¹${finalTotal.toFixed(2)}</p></div><hr><div class="mb-3"><h5>Have a Coupon?</h5><div class="d-flex"><input type="text" id="coupon-code" class="form-control" placeholder="Enter code"><button id="apply-coupon-btn" class="btn btn-secondary ms-2">Apply</button></div></div><div class="mb-3"><h5>Available Coupons:</h5><div>${couponBadges}</div></div><h5 class="mt-4">Customer Information</h5><form id="checkout-form"><div class="mb-2"><input type="text" id="cust-name" class="form-control" placeholder="Full Name" value="${currentUser?.displayName || ''}" required></div><div class="mb-2"><input type="email" id="cust-email" class="form-control" placeholder="Email Address" value="${currentUser?.email || ''}" required ${currentUser ? 'readonly' : ''}></div><div class="d-grid mt-3"><button type="submit" class="btn btn-primary btn-lg">${currentUser ? 'Proceed to Checkout' : 'Login to Checkout'}</button></div>${trustBadgesHTML}</form></div></div></div></div>`; 
            
            document.getElementById('checkout-form').addEventListener('submit', handleCheckout); 
            document.getElementById('apply-coupon-btn').addEventListener('click', () => { 
                const code = document.getElementById('coupon-code').value.toUpperCase(); 
                applyCoupon(code); 
            }); 
            initializeCountdownTimers(); 
        };
        const renderWishlistView = () => { updateSchema(null, 'product-schema'); const view = document.getElementById('wishlist-view'); if (!wishlist.length) { view.innerHTML = `<div class="text-center p-5 card"><div class="card-body"><i class="bi bi-heartbreak-fill display-1 text-muted"></i><h1 class="display-5 mt-3">Your Wishlist is Empty</h1><p class="lead text-muted">Add your favorite items to your wishlist to see them here.</p><a href="#products" class="btn btn-primary mt-3">Explore Products</a></div></div>`; return; } const items = wishlist.map(item => [item.id, products[item.id]]).filter(([, p]) => p); const listHTML = items.map(renderProductCard).join(''); view.innerHTML = `<div class="text-center mb-5"><h1 class="section-title">My Wishlist</h1><p class="section-subtitle">Your collection of favorite items. Don't let them get away!</p></div><div class="row row-cols-2 row-cols-lg-4 g-4">${listHTML}</div>`; initializeCountdownTimers(); };
        
        window.submitReview = (productId) => { const nameInput = document.getElementById('review-name'); const textInput = document.getElementById('review-text'); const ratingEl = document.querySelector('input[name="rating"]:checked'); if (!currentUser) { showToast('Please login to submit a review.', 'danger'); renderAuthModal('login'); return; } if (!nameInput.value || !textInput.value || !ratingEl) { showToast('Please fill all review fields.', 'danger'); return; } const reviewData = { uid: currentUser.uid, name: nameInput.value, text: textInput.value, rating: parseInt(ratingEl.value, 10), date: new Date().toISOString() }; const db = getDatabase(); push(ref(db, `products/${productId}/reviews`), reviewData).then(() => { showToast('Thank you for your review!', 'success'); products[productId].reviews = products[productId].reviews || {}; products[productId].reviews[`temp_${Date.now()}`] = reviewData; renderProductView(productId); const reviewCollapse = document.getElementById('collapseThree'); if(reviewCollapse) new bootstrap.Collapse(reviewCollapse).show(); }).catch((error) => { console.error("Error submitting review: ", error); showToast("Error submitting your review.", 'danger'); }); };
        
        const renderProductView = (id) => {
            const p = products[id];
            if (!p) { window.location.hash = '#404'; return; }
            trackRecentlyViewed(id);
            const priceInfo = getProductPrice(p);
            const reviews = p.reviews ? Object.values(p.reviews).sort((a,b) => new Date(b.date) - new Date(a.date)) : [];
            const reviewCount = reviews.length;
            const averageRating = reviewCount > 0 ? reviews.reduce((sum, r) => sum + parseInt(r.rating, 10), 0) / reviewCount : 0;
            const schema = { "@context": "https://schema.org", "@type": "Product", "name": p.name, "image": p.galleryImages && p.galleryImages.length > 0 ? p.galleryImages : [p.imageUrl], "description": p.description || p.subtitle, "sku": id, "brand": { "@type": "Brand", "name": "Enough Editor" }, "offers": { "@type": "Offer", "url": `${BASE_URL}/#product/${id}`, "priceCurrency": "INR", "price": priceInfo.displayPrice, "priceValidUntil": p.saleEndDate || new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString(), "availability": p.stock === 0 ? "https://schema.org/OutOfStock" : "https://schema.org/InStock" }, };
            if (reviewCount > 0) { schema.aggregateRating = { "@type": "AggregateRating", "ratingValue": averageRating.toFixed(1), "reviewCount": reviewCount }; schema.review = reviews.map(r => ({ "@type": "Review", "reviewRating": { "@type": "Rating", "ratingValue": r.rating }, "author": { "@type": "Person", "name": r.name }, "reviewBody": r.text, "datePublished": r.date })); }
            updateSchema(schema, 'product-schema');
            
            const ratingHTML = reviewCount > 0 ? `<div class="d-flex align-items-center gap-2 mb-3"><div class="star-rating-display">${renderStars(averageRating)}</div><span class="text-muted fw-medium">${averageRating.toFixed(1)} (${reviewCount} reviews)</span></div>` : '<div class="mb-3 text-muted">No reviews yet.</div>';
            const galleryImages = (p.galleryImages && Array.isArray(p.galleryImages) && p.galleryImages.length > 0) ? p.galleryImages : [p.imageUrl || 'https://via.placeholder.com/600x700.png/1e1e1e/ffffff?text=Product+Image'];
            const galleryHTML = `<div class="product-gallery"><div class="main-image-container"><button class="btn btn-sm wishlist-btn" onclick="toggleWishlist('${id}')" title="Add to Wishlist"><i class="bi ${wishlist.some(item => item.id === id) ? 'bi-heart-fill' : 'bi-heart'}"></i></button><img src="${galleryImages[0]}" class="main-image" id="main-product-image" alt="${p.name} main view"></div><div class="thumbnail-strip">${galleryImages.map((imgUrl, index) => `<img src="${imgUrl}" class="thumbnail ${index === 0 ? 'active' : ''}" alt="${p.name} thumbnail ${index + 1}" onclick="updateMainImage(this, '${imgUrl}')">`).join('')}</div></div>`;
            const previewButtonHTML = p.previewUrl ? `<a href="${p.previewUrl}" target="_blank" class="btn btn-lg btn-outline-primary"><i class="bi bi-eye-fill me-2"></i>Live Preview</a>` : '';
            
            let priceHTML = '';
            let discountBadgeHTML = '';
            if (priceInfo.isSaleActive) {
                const discount = Math.round(((p.price - p.salePrice) / p.price) * 100);
                priceHTML = `<span class="display-4 fw-bold" style="color: var(--danger-color);">â¹${p.salePrice}</span> <del class="text-muted ms-2 fs-4">â¹${p.price}</del>`;
                discountBadgeHTML = `<span class="discount-badge ms-3">${discount}% OFF</span>`;
            } else {
                priceHTML = `<p class="display-4 fw-bold mb-0" style="color: var(--primary-color);">${p.price > 0 ? `â¹${p.price}` : 'Free'}</p>`;
            }

            const saleCountdownHTML = priceInfo.isSaleActive ? `<div class="card my-4 border-danger"><div class="card-header bg-danger text-white text-center fw-bold">FLASH SALE</div><div class="card-body"><div class="sale-countdown-timer" data-sale-end="${p.saleEndDate}" data-product-id="${id}"><i class="bi bi-fire me-1"></i>Sale ends in: Loading...</div></div></div>` : '';
            const stockIndicatorHTML = p.stock && p.stock < 10 ? `<div class="alert alert-warning text-center fw-bold"><i class="bi bi-hourglass-split me-2"></i>Hurry! Only ${p.stock} left in stock.</div>` : '';

            const topSectionHTML = `<div class="row g-lg-5 g-4"><div class="col-lg-7">${galleryHTML}</div><div class="col-lg-5" data-product-id="${id}">${p.category ? `<span class="badge rounded-pill bg-primary-subtle text-primary-emphasis p-2 px-3 mb-2">${p.category}</span>` : ''}<h1 class="display-5 fw-bold mt-2">${p.name}</h1><p class="h5 text-muted">${p.subtitle || ''}</p>${ratingHTML}<div class="d-flex align-items-center my-3">${priceHTML}${discountBadgeHTML}</div>${saleCountdownHTML}${stockIndicatorHTML}<div class="d-grid gap-2 my-4"><button class="btn btn-success btn-lg" onclick="buyNow('${id}')"><i class="bi bi-bag-check-fill me-2"></i>Buy It Now</button>${previewButtonHTML}<button class="btn btn-lg btn-primary w-100" onclick="addToCart('${id}')"><i class="bi bi-cart-plus-fill me-2"></i>${priceInfo.displayPrice > 0 ? 'Add to Cart' : 'Get for Free'}</button></div><div id="live-viewer-container" class="p-3 rounded d-flex align-items-center gap-2 fw-medium mb-4" style="background-color: var(--secondary-bg); border: 1px solid var(--border-color); min-height: 52px;"></div><div class="mt-4">${p.features ? p.features.map(f => `<p class="mb-2 d-flex align-items-start gap-2"><i class="bi bi-check-circle-fill text-primary mt-1"></i> <span>${f}</span></p>`).join('') : ''}</div></div></div>`;
            const descriptionHTML = `<div class="accordion-body">${p.description ? p.description.replace(/\n/g, '<br>') : 'No detailed description available.'}</div>`; const whatsInTheBoxHTML = p.whatsInTheBox ? `<div class="accordion-body"><ul class="list-unstyled mb-0">${p.whatsInTheBox.map(item => `<li><i class="bi bi-box-seam me-2 text-primary"></i>${item}</li>`).join('')}</ul></div>` : '<div class="accordion-body"><p class="text-muted">Details not available.</p></div>'; const reviewsListHTML = reviewCount > 0 ? reviews.map(r => `<div class="border-bottom pb-3 mb-3"><div class="d-flex justify-content-between align-items-center"><h6 class="mb-0">${r.name}</h6><div class="text-muted small">${renderStars(r.rating, 'text-warning small')}</div></div><p class="mb-1 mt-2">${r.text}</p><small class="text-muted">${new Date(r.date).toLocaleDateString()}</small></div>`).join('') : '<p class="text-muted text-center py-3">Be the first to review this product!</p>'; const hasUserReviewed = currentUser && reviews.some(r => r.uid === currentUser.uid); const reviewFormHTML = hasUserReviewed ? `<div class="alert alert-info text-center mt-4">You have already reviewed this product.</div>` : `<div class="mt-4 pt-4 border-top"><h5 class="mb-3">Write a Review</h5><form id="review-form" onsubmit="event.preventDefault(); submitReview('${id}');"><div class="mb-3"><label for="review-name" class="form-label">Name</label><input type="text" class="form-control" id="review-name" required value="${currentUser?.displayName || ''}"></div><div class="mb-3"><label class="form-label">Rating</label><div class="star-rating">${[5,4,3,2,1].map(star => `<input type="radio" id="${star}-stars" name="rating" value="${star}" required/><label for="${star}-stars" class="star">â</label>`).join('')}</div></div><div class="mb-3"><label for="review-text" class="form-label">Review</label><textarea class="form-control" id="review-text" rows="3" required></textarea></div><button type="submit" class="btn btn-primary" ${!currentUser ? 'disabled' : ''}>${currentUser ? 'Submit Review' : 'Login to Review'}</button></form></div>`; const reviewsHTML = `<div class="accordion-body">${reviewsListHTML}${reviewFormHTML}</div>`; const faqHTML = p.faq ? `<div class="accordion-body">${p.faq.map(item => `<div class="mb-3"><h6>${item.question}</h6><p class="text-muted mb-0">${item.answer}</p></div>`).join('')}</div>` : '<div class="accordion-body"><p class="text-muted">No frequently asked questions available.</p></div>'; const refundPolicyHTML = `<div class="accordion-body"><p>All sales are final. Due to the digital nature of our products, we do not offer refunds. If you have an issue with your download, contact <a href="mailto:enougheditor31@gmail.com">enougheditor31@gmail.com</a>, and we will ensure you receive your purchased item.</p></div>`; const accordionHTML = `<div class="mt-5 pt-4 border-top"><div class="accordion" id="productDetailsAccordion"><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">Description</button></h2><div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#productDetailsAccordion">${descriptionHTML}</div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">What's in the Box?</button></h2><div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#productDetailsAccordion">${whatsInTheBoxHTML}</div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">Customer Reviews (${reviewCount})</button></h2><div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#productDetailsAccordion">${reviewsHTML}</div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">Frequently Asked Questions</button></h2><div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#productDetailsAccordion">${faqHTML}</div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">Refund Policy</button></h2><div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#productDetailsAccordion">${refundPolicyHTML}</div></div></div></div>`; let relatedHTML = ''; if (p.category) { const related = Object.entries(products).filter(([pid, prod]) => prod.category === p.category && pid !== id).slice(0, 4); if (related.length > 0) { relatedHTML = `<section class="section container mt-5"><h2 class="section-title text-center">You Might Also Like</h2><div class="row row-cols-2 row-cols-lg-4 g-4">${related.map(renderProductCard).join('')}</div></section>`; } }
            document.getElementById('product-view').innerHTML = `<div class="container">${topSectionHTML}${accordionHTML}</div>${relatedHTML}${renderRecentlyViewed()}`;
            initializeCountdownTimers(); // Re-initialize timers for the new view
            const startLiveViewer = () => { clearInterval(liveViewerInterval); const viewerContainer = document.getElementById('live-viewer-container'); if (!viewerContainer) return; let count = liveViewCounts[id] || Math.floor(Math.random() * 40) + 11; const phrases = [ "people are viewing this right now", "others are interested in this", "creators are looking at this", "people have this in their cart" ]; let phraseIndex = 0; const updateViewer = () => { count += Math.floor(Math.random() * 3) - 1; count = Math.max(7, count); liveViewCounts[id] = count; const currentPhrase = phrases[phraseIndex]; phraseIndex = (phraseIndex + 1) % phrases.length; viewerContainer.innerHTML = `<i class="bi bi-eye-fill text-primary"></i><span><strong class="me-1">${count}</strong> ${currentPhrase}</span>`; }; updateViewer(); liveViewerInterval = setInterval(updateViewer, 2500); }; startLiveViewer();
        };

        window.updateMainImage = (thumbElement, newSrc) => { const mainImage = document.getElementById('main-product-image'); if (mainImage.src === newSrc) return; mainImage.style.opacity = '0'; setTimeout(() => { mainImage.src = newSrc; mainImage.style.opacity = '1'; }, 300); document.querySelectorAll('.product-gallery .thumbnail').forEach(t => t.classList.remove('active')); thumbElement.classList.add('active'); };
        
        const renderProfileView = async () => { updateSchema(null, 'product-schema'); const view = document.getElementById('profile-view'); if (!currentUser) { view.innerHTML = `<div class="text-center"><h1>Access Denied</h1><p>Please <a href="#" onclick="renderAuthModal('login')">login</a> to view your profile.</p></div>`; return; } const db = getDatabase(); const userRef = ref(db, `users/${currentUser.uid}`); const userSnap = await get(userRef); let userData = userSnap.val() || {}; if (!userData.referralCode && currentUser.displayName) { const referralCode = (currentUser.displayName.substring(0, 4).toUpperCase() || 'USER') + currentUser.uid.substring(0, 4).toUpperCase(); const updates = {}; updates[`/users/${currentUser.uid}/referralCode`] = referralCode; updates[`/referralCodes/${referralCode}`] = { uid: currentUser.uid }; await update(ref(db), updates); userData.referralCode = referralCode; }
        const accountDetailsHTML = `<div class="card mb-4"><div class="card-header"><strong><i class="bi bi-person-badge-fill me-2"></i>Account Details</strong></div><div class="card-body"><p class="mb-2"><strong>Email:</strong> ${currentUser.email} ${currentUser.emailVerified ? '<span class="badge bg-success-subtle text-success-emphasis rounded-pill ms-2"><i class="bi bi-check-circle-fill me-1"></i>Verified</span>' : '<span class="badge bg-warning-subtle text-warning-emphasis rounded-pill ms-2">Not Verified</span>'}</p><form id="update-profile-form" class="mt-3"><label for="update-name-input" class="form-label"><strong>Display Name:</strong></label><div class="input-group"><input type="text" id="update-name-input" class="form-control" value="${currentUser?.displayName || ''}" required><button class="btn btn-outline-primary" type="submit">Update</button></div></form></div></div>`;
        const referralHTML = `<div class="card mb-4"><div class="card-header"><strong><i class="bi bi-gift-fill me-2"></i>Refer & Earn</strong></div><div class="card-body text-center"><p class="lead">Share your referral code. When friends use it, you both get a <strong class="text-primary">${settings.referralDiscount || 15}%</strong> coupon!</p><p class="h4">Your Referral Code:</p><div class="input-group mt-2" style="max-width:300px; margin:auto;"><input type="text" class="form-control text-center fs-5" value="${userData.referralCode || 'N/A'}" readonly><button class="btn btn-outline-secondary" onclick="navigator.clipboard.writeText('${userData.referralCode}'); showToast('Code Copied!', 'info');" ${!userData.referralCode ? 'disabled' : ''}><i class="bi bi-clipboard"></i></button></div></div></div>`;
        const redeemHTML = `<div class="card mb-4" id="redeem-code-card"><div class="card-header"><strong><i class="bi bi-patch-check-fill me-2"></i>Redeem a Code</strong></div><div class="card-body"><form id="profile-redeem-form"><div class="input-group"><input type="text" id="profile-referral-code-input" class="form-control" placeholder="Enter friend's referral code" required><button type="submit" class="btn btn-primary">Redeem</button></div></form></div></div>`;
        const coupons = userData.coupons ? Object.entries(userData.coupons).filter(([,c]) => new Date(c.expiry) > new Date()) : []; const couponsHTML = `<div class="card mb-4" id="my-coupons-card"><div class="card-header"><strong><i class="bi bi-ticket-percent-fill me-2"></i>My Coupons</strong></div>${coupons.length > 0 ? `<ul class="list-group list-group-flush">${coupons.map(([id, coupon]) => `<li class="list-group-item d-flex justify-content-between align-items-center"><div><i class="bi bi-ticket-detailed-fill me-3 text-primary fs-4 align-middle"></i><strong class="text-primary align-middle">${coupon.code}</strong><br><small class="text-muted ms-5">${coupon.expiry ? `Expires ${new Date(coupon.expiry).toLocaleDateString()}` : 'No expiry'}</small></div><button class="btn btn-sm btn-outline-secondary" onclick="navigator.clipboard.writeText('${coupon.code}'); showToast('Copied!', 'info');"><i class="bi bi-copy"></i></button></li>`).join('')}</ul>` : `<div class="card-body text-center text-muted">You have no active coupons.</div>`}</div>`;
        view.innerHTML = `<div class="text-center mb-5"><h1 class="section-title">My Profile</h1><p class="lead">Hello, ${currentUser.displayName}! Here is your information and past orders.</p></div><div class="row g-4"><div class="col-lg-7">${accountDetailsHTML}${couponsHTML}${redeemHTML}</div><div class="col-lg-5">${referralHTML}</div></div><h3 class="mt-5">My Orders</h3><div id="order-history-list"><div class="text-center p-5"><div class="spinner-border"></div></div></div>`; document.getElementById('profile-redeem-form').addEventListener('submit', handleRedeemCode); document.getElementById('update-profile-form').addEventListener('submit', handleUpdateProfile);
        const orderHistoryListEl = document.getElementById('order-history-list'); try { const ordersRef = ref(db, `orders/${currentUser.uid}`); const snapshot = await get(ordersRef); if (!snapshot.exists()) { orderHistoryListEl.innerHTML = `<div class="card card-body text-center text-muted">You have no past orders.</div>`; return; } const orders = snapshot.val(); const orderHistoryHTML = Object.entries(orders).reverse().map(([orderId, order]) => { const itemsHTML = order.items.map(item => { const p = products[item.id]; if (!p) return `<li class="list-group-item">Product not found</li>`; return `<li class="list-group-item d-flex justify-content-between align-items-center"><div><img src="${p.imageUrl}" width="40" height="40" class="rounded me-3 object-fit-cover"><strong>${p.name}</strong></div><a href="${p.fileUrl}" class="btn btn-sm btn-outline-primary" target="_blank" download><i class="bi bi-download me-1"></i> Re-download</a></li>`; }).join(''); return `<div class="card mb-4"><div class="card-header d-flex justify-content-between flex-wrap"><div><strong>Order Date:</strong> ${new Date(order.date).toLocaleDateString()}</div><div><strong>Total:</strong> â¹${order.total.toFixed(2)}</div><div class="text-muted small w-100 mt-1">Payment ID: ${order.paymentId || 'N/A'}</div></div><ul class="list-group list-group-flush">${itemsHTML}</ul></div>`; }).join(''); orderHistoryListEl.innerHTML = orderHistoryHTML; } catch (error) { console.error("Error fetching orders:", error); orderHistoryListEl.innerHTML = `<div class="alert alert-danger">Could not load order history.</div>`; } };
        const startGiveawayCountdown = (endDate, timerElementId) => { clearInterval(giveawayCountdownInterval); const timerEl = document.getElementById(timerElementId); giveawayCountdownInterval = setInterval(() => { const now = new Date().getTime(); const distance = new Date(endDate).getTime() - now; if (distance < 0) { clearInterval(giveawayCountdownInterval); renderGiveawayView(); return; } const days = Math.floor(distance / (1000 * 60 * 60 * 24)); const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)); const seconds = Math.floor((distance % (1000 * 60)) / 1000); timerEl.innerHTML = `<div><span>${days}</span><small>Days</small></div><div><span>${hours}</span><small>Hours</small></div><div><span>${minutes}</span><small>Minutes</small></div><div><span>${seconds}</span><small>Seconds</small></div>`; }, 1000); };
        window.joinGiveaway = (giveawayId) => { if (!currentUser) { renderAuthModal('login'); showToast('Please login to join the giveaway!', 'warning'); return; } const giveaway = giveaways[giveawayId]; if (giveaway.participants && giveaway.participants[currentUser.uid]) { showToast("You've already joined this giveaway.", "info"); return; } const db = getDatabase(); const participantRef = ref(db, `giveaways/${giveawayId}/participants/${currentUser.uid}`); set(participantRef, { name: currentUser.displayName, email: currentUser.email, joinedAt: new Date().toISOString() }).then(() => { showToast("Success! You've joined the giveaway.", "success"); document.getElementById('join-giveaway-btn').disabled = true; document.getElementById('join-giveaway-btn').innerHTML = `<i class="bi bi-check-lg me-2"></i> You've Joined!`; }).catch(err => showToast(`Error joining: ${err.message}`, 'danger')); };
        const renderGiveawayView = () => { updateSchema(null, 'product-schema'); const view = document.getElementById('giveaway-view'); const activeGiveawayId = Object.keys(giveaways)[0]; const giveaway = activeGiveawayId ? giveaways[activeGiveawayId] : null; if (!giveaway) { view.innerHTML = `<div class="text-center"><h1>Giveaways</h1><p class="lead">No active giveaways at the moment. Check back soon!</p></div>`; return; } const endDate = new Date(giveaway.endDate); const now = new Date(); const hasEnded = now > endDate; let actionSectionHTML = ''; if (hasEnded) { if (giveaway.winner) { actionSectionHTML = `<div class="mt-4 winner-announcement"><i class="bi bi-trophy-fill display-2"></i><h3 class="mt-3">The Giveaway has ended!</h3><p class="lead">Congratulations to the winner:</p><p class="display-4">${giveaway.winner}</p></div>`; } else { actionSectionHTML = `<div class="alert alert-info mt-4">The giveaway has ended. The winner will be announced shortly!</div>`; } } else { const hasJoined = currentUser && giveaway.participants && giveaway.participants[currentUser.uid]; actionSectionHTML = `<h4 class="mt-5 mb-3 text-center">Giveaway Ends In</h4><div id="countdown-timer" class="mb-4"></div><div class="d-grid mt-4"><button id="join-giveaway-btn" class="btn btn-primary btn-lg" onclick="joinGiveaway('${activeGiveawayId}')" ${hasJoined ? 'disabled' : ''}>${hasJoined ? `<i class="bi bi-check-lg me-2"></i> You've Joined!` : `<i class="bi bi-gift-fill me-2"></i> Join The Giveaway`}</button></div>`; } view.innerHTML = `<div class="text-center mb-5"><h1 class="section-title">${giveaway.title}</h1><p class="section-subtitle">Don't miss your chance to win! Join now for free.</p></div><div class="card shadow-sm"><img src="${giveaway.imageUrl}" class="card-img-top" alt="${giveaway.title}"><div class="card-body p-4 p-md-5"><p class="card-text lead">${giveaway.description}</p>${actionSectionHTML}</div></div>`; if (!hasEnded) { startGiveawayCountdown(giveaway.endDate, 'countdown-timer'); } };
        const renderBlogView = () => { updateSchema(null, 'product-schema'); const view = document.getElementById('blog-view'); const posts = Object.entries(blogs); let html = `<div class="text-center mb-5"><h1 class="section-title">Our Blog</h1><p class="section-subtitle">Tips, tutorials, and insights for modern creators.</p></div>`; if (posts.length === 0) { html += `<div class="card card-body text-center text-muted">No blog posts yet. Check back soon!</div>`; } else { const postHTML = posts.map(([id, post]) => ` <div class="col-md-6 col-lg-4 mb-4"> <div class="card blog-card h-100"> <a href="#blog-post/${id}" class="text-decoration-none"><img src="${post.imageUrl}" class="card-img-top" alt="${post.title}"></a> <div class="card-body"> <h5 class="card-title"><a href="#blog-post/${id}" class="text-decoration-none" style="color: var(--text-color);">${post.title}</a></h5> <p class="card-text">${post.excerpt}</p> <div class="mt-auto"> <p class="blog-card-meta">By ${post.author} on ${new Date(post.date).toLocaleDateString()}</p> <a href="#blog-post/${id}" class="btn btn-sm btn-outline-primary">View Post</a> </div> </div> </div> </div> `).join(''); html += `<div class="row">${postHTML}</div>`; } view.innerHTML = html; };
        const renderBlogPostView = (id) => { const post = blogs[id]; if (!post) { window.location.hash = '#404'; return; } const view = document.getElementById('blog-post-view'); view.innerHTML = `<div class="row justify-content-center"><div class="col-lg-9"><article><div class="blog-post-header"> <h1 class="section-title mb-3">${post.title}</h1> <p class="blog-card-meta">Posted by ${post.author} on ${new Date(post.date).toLocaleDateString()}</p></div><img src="${post.imageUrl}" class="blog-post-image" alt="${post.title}"><div class="blog-post-content">${(post.content || post.excerpt).replace(/\n/g, '<br><br>')}</div> ${post.link ? `<hr class="my-5"><div class="text-center"><a href="${post.link}" class="btn btn-secondary" target="_blank" rel="noopener noreferrer">Read Original Source <i class="bi bi-box-arrow-up-right ms-2"></i></a></div>` : ''}</article></div></div>`; };
        const render404View = () => { updateSchema(null, 'product-schema'); document.getElementById('404-view').innerHTML = `<i class="bi bi-compass-fill display-1 text-primary"></i><h1 class="display-3 mt-4">404 - Page Not Found</h1><p class="lead text-muted">Oops! The page you're looking for doesn't exist.</p><a href="#home" class="btn btn-primary btn-lg mt-3">Go to Homepage</a>`; };
        const handleCheckout = async (e) => { // Added async
            e.preventDefault(); 
            if (!currentUser) { 
                checkoutAfterLogin = true; 
                renderAuthModal('login'); 
                showToast('Please login to continue', 'warning'); 
                return; 
            } 
            if (!currentUser.emailVerified) { 
                renderAuthModal('verify'); 
                showToast('Please verify your email to checkout.', 'danger'); 
                return; 
            } 
            
            const subtotal = cart.reduce((sum, item) => sum + (getProductPrice(products[item.id]).displayPrice || 0), 0); 
            let finalTotal = subtotal; 
            if(appliedCoupon) { 
                finalTotal = subtotal - (subtotal * (appliedCoupon.discount / 100)); 
            }

            // Ensure finalTotal is not negative and rounded for payment gateway
            finalTotal = Math.max(0, parseFloat(finalTotal.toFixed(2))); 

            const orderData = { 
                customer: { name: document.getElementById('cust-name').value, email: currentUser.email }, 
                items: cart, 
                subtotal: subtotal, 
                discount: appliedCoupon, 
                total: finalTotal, 
                date: new Date().toISOString() 
            };

            const downloadItemsHTML = cart.map(item => { 
                const p = products[item.id]; 
                return `<div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded" style="background-color: var(--secondary-bg);"><div class="d-flex align-items-center text-truncate gap-3"><img src="${p.imageUrl}" width="60" height="70" class="rounded object-fit-cover"><span class="fw-medium text-truncate">${p.name}</span></div><a href="${p.fileUrl}" class="btn btn-success" target="_blank" download><i class="bi bi-download me-2"></i>Download</a></div>`; 
            }).join(''); 

            // IMPROVED: Handle 100% coupon / Free checkout directly
            if (finalTotal === 0) {
                try {
                    // Generate a pseudo payment ID for free orders
                    const pseudoPaymentId = `FREE_${Date.now()}_${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
                    orderData.paymentId = pseudoPaymentId;
                    orderData.status = 'Free'; // Mark as free order
                    
                    await set(push(ref(getDatabase(), `orders/${currentUser.uid}`)), orderData);

                    document.getElementById('download-content').innerHTML = `
                        <div class="text-center">
                            <i class="bi bi-patch-check-fill text-success" style="font-size: 5rem;"></i>
                            <h3 class="mt-3">Order Complete!</h3>
                            <p class="text-muted mb-4">Your free downloads are ready. You can also find them anytime in your profile.</p>
                        </div>
                        <div class="mt-4">${downloadItemsHTML}</div>
                        <div class="d-grid mt-4">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close & Go to Profile</button>
                        </div>`;
                    downloadModal.show();
                    celebrate();
                    document.getElementById('downloadModal').addEventListener('hidden.bs.modal', () => { window.location.hash = '#profile'; }, { once: true });
                    cart = [];
                    appliedCoupon = null;
                    updateCartUI();
                } catch (error) {
                    console.error("Error processing free order:", error);
                    showToast(`Failed to process free order: ${error.message}`, 'danger');
                }
                return;
            }

            // Regular Razorpay payment if amount is > 0
            if (!settings.razorpayKeyId) { 
                showToast('Payment gateway error: Razorpay Key ID not configured.', 'danger'); 
                return; 
            } 
            
            new Razorpay({ 
                key: settings.razorpayKeyId, 
                amount: Math.round(finalTotal * 100), // Razorpay expects amount in paisa
                currency: "INR", 
                name: "Enough Editor Store", 
                handler: async (r) => { // Made handler async
                    orderData.paymentId = r.razorpay_payment_id;
                    orderData.status = 'Paid'; // Mark as paid order
                    
                    await set(push(ref(getDatabase(), `orders/${currentUser.uid}`)), orderData); // Use await here

                    document.getElementById('download-content').innerHTML = `
                        <div class="text-center">
                            <i class="bi bi-patch-check-fill text-success" style="font-size: 5rem;"></i>
                            <h3 class="mt-3">Payment Successful!</h3>
                            <p class="text-muted mb-4">Your downloads are ready. You can also find them anytime in your profile.</p>
                        </div>
                        <div class="mt-4">${downloadItemsHTML}</div>
                        <div class="d-grid mt-4">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close & Go to Profile</button>
                        </div>`;
                    downloadModal.show();
                    celebrate();
                    document.getElementById('downloadModal').addEventListener('hidden.bs.modal', () => { window.location.hash = '#profile'; }, { once: true });
                    cart = [];
                    appliedCoupon = null;
                    updateCartUI();
                }, 
                prefill: { 
                    name: document.getElementById('cust-name').value, 
                    email: currentUser.email 
                }, 
                theme: { color: "#4b88ff" } 
            }).open(); 
        };
        const handleRedeemCode = async (e) => { e.preventDefault(); const input = e.target.id === 'profile-redeem-form' ? document.getElementById('profile-referral-code-input') : document.getElementById('modal-referral-code-input'); const code = input.value.trim().toUpperCase(); if (!code) return; if (!currentUser) { showToast("Please login to redeem a code.", "danger"); return; } const db = getDatabase(); const userSnap = await get(ref(db, `users/${currentUser.uid}`)); if (userSnap.val()?.redeemedReferral) { showToast("You have already redeemed a referral code.", "info"); return; } const ownCode = userSnap.val()?.referralCode; if(code === ownCode) { showToast("You cannot redeem your own code.", "danger"); return; } const codeSnap = await get(ref(db, `referralCodes/${code}`)); if (!codeSnap.exists()) { showToast("Invalid referral code.", "danger"); return; } const referrerUid = codeSnap.val().uid; const discount = settings.referralDiscount || 15; const durationDays = settings.referralCouponDuration || 30; const expiry = new Date(Date.now() + durationDays * 24 * 60 * 60 * 1000).toISOString(); const newCouponCodeUser = `REF${discount}-${currentUser.uid.slice(0, 4)}`;
        // Ensure newCouponCodeReferrer uses the actual referrer UID, not current user's UID slice
        const newCouponCodeReferrer = `REF${discount}-${referrerUid.slice(0, 4)}`; 
        const updates = {}; updates[`/users/${currentUser.uid}/redeemedReferral`] = code; updates[`/users/${currentUser.uid}/coupons/${newCouponCodeUser}`] = { code: newCouponCodeUser, discount, expiry }; updates[`/users/${referrerUid}/coupons/${newCouponCodeReferrer}`] = { code: newCouponCodeReferrer, discount, expiry }; updates[`/coupons/${newCouponCodeUser}`] = discount; updates[`/coupons/${newCouponCodeReferrer}`] = discount; await update(ref(db), updates); showToast(`Success! A ${discount}% coupon has been added to your account.`, 'success'); if(referralModal._element.classList.contains('show')) referralModal.hide(); renderProfileView(); };
        
        // --- ROUTING & INITIALIZATION ---
        const switchView = (viewId) => { 
            clearInterval(liveViewerInterval); 
            clearInterval(giveawayCountdownInterval); 
            // initializeCountdownTimers now handles its own clearing, so no need to clear here globally

            document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); 
            const viewEl = document.getElementById(viewId); 
            if (viewEl) viewEl.classList.add('active'); 
            let navId = viewId.replace('-view','').split('/')[0]; 
            document.querySelectorAll('.navbar-nav .nav-link, .mobile-nav-item').forEach(l => l.classList.remove('active')); // Adjusted selector
            document.querySelector(`.navbar-nav .nav-link[href="#${navId}"]`)?.classList.add('active'); 
            if (navId === 'blog-post') navId = 'blog'; 
            const mobileNavItem = document.querySelector(`.mobile-nav-item[data-nav="${navId}"]`); 
            if (mobileNavItem) mobileNavItem.classList.add('active'); 
            // Removed radial menu specific logic
            window.scrollTo(0, 0); 
        };
        const router = () => { 
            console.log('Router called. Current hash:', window.location.hash); // Debugging: Confirm router is called
            const hash = window.location.hash || '#home'; 
            const [route, param] = hash.substring(1).split('/'); 
            
            // Reset filters for new navigation unless it's a direct filter link
            if (route !== 'products') {
                filters.onSaleOnly = false;
                filters.search = '';
                filters.minPrice = null;
                filters.maxPrice = null;
                filters.category = 'All';
                filters.sortBy = 'newest';
            }

            if (route === 'product' && param) { 
                renderProductView(param); switchView('product-view'); 
            } else if (route === 'products') { 
                if (param === 'sale') { // Handle #products/sale route
                    filters.onSaleOnly = true;
                }
                renderProductsView(filters.onSaleOnly); 
                switchView('products-view'); 
            } else if (route === 'cart') { 
                renderCartView(); switchView('cart-view'); 
            } else if (route === 'wishlist') { 
                renderWishlistView(); switchView('wishlist-view'); 
            } else if (route === 'profile') { 
                renderProfileView(); switchView('profile-view'); 
            } else if (route === 'giveaway') { 
                renderGiveawayView(); switchView('giveaway-view'); 
            } else if (route === 'support') { 
                switchView('support-view'); 
            } else if (route === 'blog') { 
                renderBlogView(); switchView('blog-view'); 
            } else if (route === 'blog-post' && param) { 
                renderBlogPostView(param); switchView('blog-post-view'); 
            } else if (route === 'home' || route === '') { 
                renderHomeView(); switchView('home-view'); 
            } else { 
                render404View(); switchView('404-view'); 
            }
        };
        
        function initializeAppAndUI() {
            try {
                if (window.matchMedia("(pointer: fine)").matches) { const cursorDot = document.createElement('div'); cursorDot.className = 'cursor-dot'; document.body.appendChild(cursorDot); const cursorOutline = document.createElement('div'); cursorOutline.className = 'cursor-outline'; document.body.appendChild(cursorOutline); let mouseX = 0, mouseY = 0, outlineX = 0, outlineY = 0; window.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; }); const animateCursor = () => { cursorDot.style.left = `${mouseX}px`; cursorDot.style.top = `${mouseY}px`; const delay = 0.1; outlineX += (mouseX - outlineX) * delay; outlineY += (mouseY - outlineY) * delay; cursorOutline.style.left = `${outlineX}px`; cursorOutline.style.top = `${outlineY}px`; requestAnimationFrame(animateCursor); }; animateCursor(); window.addEventListener('mousedown', e => { const splash = document.createElement('div'); splash.className = 'cursor-splash'; splash.style.left = `${e.clientX}px`; splash.style.top = `${e.clientY}px`; document.body.appendChild(splash); setTimeout(() => splash.remove(), 500); }); const interactiveElements = 'a, button, .btn, .form-check-input, .thumbnail, .star-rating label, [onclick], .swiper-pagination-bullet'; document.addEventListener('mouseover', e => { if (e.target.closest(interactiveElements)) document.body.classList.add('cursor-hover'); }); document.addEventListener('mouseout', e => { if (e.target.closest(interactiveElements)) document.body.classList.remove('cursor-hover'); }); }
                downloadModal = new bootstrap.Modal(document.getElementById('downloadModal')); authModal = new bootstrap.Modal(document.getElementById('authModal')); referralModal = new bootstrap.Modal(document.getElementById('referralModal')); filterOffcanvas = new bootstrap.Offcanvas(document.getElementById('filterOffcanvas')); sortOffcanvas = new bootstrap.Offcanvas(document.getElementById('sortOffcanvas'));
                
                const app = initializeApp(firebaseConfig); const database = getDatabase(app); const auth = getAuth(app); getAnalytics(app);
                onAuthStateChanged(auth, user => { currentUser = user; updateAuthUI(user); syncCartWithFirebase(); router(); if (user && localStorage.getItem('showReferralPopup') === 'true') { referralModal.show(); localStorage.removeItem('showReferralPopup'); }});
                
                initializeTheme();

                document.getElementById('theme-toggler').addEventListener('click', () => { 
                    const newTheme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
                    if (!document.startViewTransition) {
                        applyTheme(newTheme);
                        return;
                    }
                    document.startViewTransition(() => applyTheme(newTheme));
                });

                const dataPromises = [ 
                    get(ref(database, 'settings')).then(s => settings = s.val() || {}), 
                    get((ref(database, 'coupons'))).then(s => availableCoupons = s.val() || {}), 
                    get(ref(database, 'giveaways')).then(s => giveaways = s.val() || {}), 
                    get(ref(database, 'products')).then(s => products = s.val() || {}), 
                    get(ref(database, 'blogs')).then(s => blogs = s.val() || {}) 
                ];
                Promise.all(dataPromises).then(() => {
                    const preloader = document.getElementById('preloader'); preloader.classList.add('preloader-hidden'); document.getElementById('app-container').style.display = 'flex'; setTimeout(() => { if (preloader) preloader.style.display = 'none'; }, 600);
                    
                    router(); // Call router initially after data is loaded
                    onValue(ref(database, 'products'), (snap) => { products = snap.val() || {}; router()}); 
                    onValue(ref(database, 'coupons'), (snap) => { availableCoupons = snap.val() || {}; if (window.location.hash === '#cart') renderCartView(); }); 
                    onValue(ref(database, 'giveaways'), (snap) => { giveaways = snap.val() || {}; if (window.location.hash === '#giveaway') renderGiveawayView(); });
                    onValue(ref(database, 'settings'), (snap) => { 
                        settings = snap.val() || {};
                    });

                }).catch(error => { const preloader = document.getElementById('preloader'); if (preloader) preloader.style.display = 'none'; document.body.innerHTML = `<div class="alert alert-danger m-5">Error loading page data. Please try again later. Details: ${error.message}</div>`; console.error(error); });
                window.addEventListener('hashchange', router);
                document.getElementById('modal-redeem-form').addEventListener('submit', handleRedeemCode);
                
                updateCartUI(); updateWishlistUI();
            } catch (error) { document.body.innerHTML = `<div class="alert alert-danger m-5">A critical error occurred.</div>`; console.error(error);}
        }
        initializeAppAndUI();
    </script>
</body>
</html>
